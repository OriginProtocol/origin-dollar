const { expect } = require("chai");
const { keccak256, parseUnits } = require("ethers/lib/utils");

const addresses = require("../../utils/addresses");
const { calcBlockTimestamp, hashPubKey } = require("../../utils/beacon");
const { resolveContract } = require("../../utils/resolvers");
const { impersonateAndFund } = require("../../utils/signers");

const { createFixtureLoader, beaconChainFixture } = require("../_fixture");
const { advanceTime } = require("../helpers");
const { calcDepositRoot } = require("../../tasks/beaconTesting");
const loadFixture = createFixtureLoader(beaconChainFixture);

const secondClusterOperatorIds = [752, 753, 754, 755];
const secondClusterPubKeys = [
  "0xb7e1156c6ca50c42f60fc3503d435ecc430614d9d0304442d0badea7c648de854fa1b37c3125c8ff4de9ca765823eefd",
  "0xace3a5e7b04a2f9b8ddc79524181571654c4e9569d571c3d0a9742fa0fe2db8d54014fb72cfa74a5e23b9676e461fdc9",
  "0xa018a0216aa11b0ab61e7adcd9bd163f567e4b5ed7de3a89c6488efc932d7965bf708999c9fe28ce37a165b8161d5681",
  "0xa032b875e9d6bbeab98d6b060bcb3a145ec666d50c80aa6be6aaa4684d57402c01caf80ae28ee94a81fabbf50e9bd249",
  "0xa0667d5b740b71b8ae50c07d695c1f1e4363fc52057a931dfec42c389069bfa3eed9acc5312044d3896f1cdb2d54d3df",
  "0xa241e3d37b54f92c965fb3c390b900d85f416c47b7d4057331620b359e9c8f34f265cc532ca52403c59f2fca42e7c9f2",
  "0xa2f883624840cb5bf744c23c477efdcb3e7cccfbbd5bb7eef00a7fd9860765f9a1c82616e5107fada49d2786c239c8ae",
  "0xa9da10b01962ca118b3ad409f384ec1acf2c76020633b5c80bc432a52c2413df5aeef0a6c7d3cf6c69d79278c2d1ac91",
  "0xabad67a3625c14e85922aa72f452df88bffc7a2d30e2916dbfe78f174c699cde529b8c30cef43ad43c2734b857999a0c",
  "0xae12edc5d57aa4999038c8968184af8236d551e7051df5c8682dc984638cec4716c23cd40a65eb9a3fd8ba73e9877c0c",
  "0xb9081e786155204e9d6d8739651bffd7e019c9104fcff1b9598cdbe596cea1fae99a99ad8cac9647be2001317da07b91",
  "0x84bfb105e60735a20ba9a4c2ce8e8a117a1fb9c66e8cc20ce1d880de69cb093c068bbe72924e272098d7018eca2ed130",
  "0x851149b79b15b1bfc02f70d04860c64ba85ff0e63765d42fe39117f38ef66f3bfbf071c3241ae0d96917f175b1379e37",
  "0x870d2a79d2ca276158b62b10ccfc608b8435c8df8d0d1f5bb1290dd4fd396759843248fd7877be8bc2183684ab07bcfe",
  "0x8757a40dc9a2351536654a1d82cc01f8bf2acd1a04c2cbc4e7a50310ba3a9bd932980b4e531dcadcdf65361691896590",
  "0x897fc84f154b2a2be55058a7a2c122cbc48bdf1d4f030a6d1d0216caeb0f51ff777c23b6dc4601006a6e6ebed38be081",
  "0x8a8c7ace7d84cb3cba43cafb5bc21b84df457d51b57c3c63dadd2dd4c093e17cfc95a07fde55cdc9225978df8f095bc4",
  "0x8e44878278bbd96c980b66a74ffc9b71a835f3991064a645d7e1836d99de6acfd6c7061148d5034f6959e69f419f44a9",
  "0x8ed6e3d45faed1f149ce35f8f0371e922cc4ff99e93cd938fde696acab2be58c09adb4c3909b54f22aa5325fefcf5a74",
  "0xa0feaa07399cd3635f881f54d8ebb51c4bedf376149f4c649a5ab5a1f1eae8ea4759dd5e3521a9f367e09dcc9182cdea",
  "0xa8188c3d4618f4e45c8fc0d8e4b686e92c7b128993a2efefd5c8edc9f1ed5c5a5b0421be6c6e01284c4be778b8d351af",
  "0xaa70003c8439881aaa268e71fe5290185a4f66f51597f883837fea71690b419bfc2ebcd02fb21386feea7c8ac41a8ed8",
  "0xab4d5f12e16034a72244f9f1a1a3ac9d4951b58106f89c604e5631530dc2accd7e5f24e7150ad5e1cbe899f1eaf1ce7d",
  "0xacf48a22e69b0ba9df39d775b1799f6bceeeb0888c39fb909b3c9af4b95c7d85907b1fac37a3abe249981cdec3f52426",
  "0xad4ccd890dff1e95993158c64790fcd51b44245858173619976532ab6044f584e23b09445f1ca0207161cd2ce831249a",
  "0xb8d868f540cdaeac91ee049382049d6263a04ad0cd7e89f61992f4626640a22225975bc14ca896f8a62203629411447f",
  "0xb97684ed60df7e58d33819e522bf248b87ed2ca431f2458d9e4bc95a43715266bbc3fb510923d51a683ab2380098de70",
  "0x80a5f26411ffab3778166b6614551b2aa8cc73f56f9d36958cffad0ffa37c10bb629ba9101df605849f5b69248893d12",
  "0x8d2e3214eb39d8db9a486975a0f71bda253a332938341fcddeb2ca7ffe8e18d5ce99d4844e5acd3f05110734ce43afa2",
  "0x8d411e1ac3d246897d5e977722ab79e22b8f4692393770928c201ac88b98431676ab56833179fffd761ee47ba02e567b",
  "0x8d875da93d02e3c0fb90ab11a4b079f8b2f9d83035ecdccf55df17afc9ae5b352674d08daf766fb2d30f39bce1ce29ba",
  "0x90d1cd1c19af352d82363eca0f0fdd9d35a7fde98240f217d136c8e7841ab091d7a1a78d396542abf9b5cb1c8035f8ea",
  "0x94d22fce3edc96965d2cf289969fb3099101761534bfe9d029edb319a683cadb295bf02c0610b98c91c91a904db03611",
  "0xa1b4899e5460428df7b66007cccad6dee6ce3183b856897070d23cf4cb8de7fb8a1bf02a42e5b4a761cf68adcf2dc5ae",
  "0xa4f24e7e1d3ec6b56d6085f2c15d6f19ebefe2e5d8c08de58830ef254131c34c8bc5a6a85b1daf60ff3331c05790929b",
  "0xa577f2c72d35d5dff2d76cc8169e32c32a9a114c904dff1094d86f2efe6021b795e63671e1464a0741f015ed73ada55e",
  "0xab14b385b3cf1ba09048d7177eaab385cb9a3b3ad4a44e6c6c714811b9ee1cfe9243aaf212957e7306567df8f92b962f",
  "0xab53c575fc015ba508aca923062903cb6b7635d09835fd5825d98dcfde4da7445ca1ac5db52e094d4c32204344999647",
  "0xb065146c773f831935702bb58d0fae499cf8e3c89db491efeb04e1545aee69dc3c077e5d5e470bbc888dbf3478891bc8",
];

const thirdClusterOperatorIds = [338, 339, 340, 341];
const thirdClusterPubKeys = [
  "0x999702d1ad3f224ac76dca1edcb91c5e7d1e05bd13646cd4d0b0fa1252ad3ace4d8b34f48a7c4ca13c84a7c71f175c72",
  "0xa5fe057240ad0ea978f7ac58130ff124c733de28ac271878178d00017b91353062bcc220cabaeccbc77fba71a48d4dfa",
  "0xb734f922193e9f5fa82bc023703b6ff9d48b94d7dc37bd02514268881834bc8117d82fc33bae857f5a1ac1e5ee5c2395",
];

const activeTargetPubKey =
  "0xb5d37226e27e0ab066541ccb795e04149300bb8c0b0fd528785f6a940e94c624b65ef1eb771f78a5f2685317b7e6f34f";

// Balance proofs after the deposit to validator 13498458 has been verified.
// Run the following Hardhat task to get the proofs:
// pnpm hardhat verifyBalances --network mainnet --dryrun true --active-ids 2178131,2183214
const balanceProofs = {
  balancesContainerRoot:
    "0x6301b3758c02d9a1b3364e5d0e955c6f41a39fbb28c5b7e11b36f3bc047c4b27",
  balancesContainerProof:
    "0x4333928069982964e94e1bbe2c61c5faa996a4e61a3d64eb818d33d176d03ae18ce186f0e1c87ddb05aff7e2efdba134a152be5c12069e276ff6a045978151973d928aa6c51efe9d2b6c4aadca1a365587651cb2b2f8c5bd51bf521b0c749a2d7fcb39e7def4794e4bc6518a66a200295ca40e684be30efefabae3af40e856ab7ca7b06c22937561c4317f3305e283b6d6fabd4a230d5facab9c97367cca50be97cd0f019fb861a99a9e367ff02be23457b3181644b586d5d9ee19b8858e13bfd9c23ad502758c52d175f6d58baaf83b853558e11930df26cdf5305702b90fa191e7ef00c1b8963aaa0798ff7b23f54c142f4778757bfd40e47048935ec2db45c3b54249619b043128fe7460f5608f44f1c76135abb223b5e4aafee8e6d5b0b7",
  validatorBalanceLeaves: [
    "0x993fa07307000000cac46196260000009a2aa0730700000000ca9a3b00000000",
    "0xd7c523790700000000ca9a3b00000000089a9d73070000008e879d7307000000",
    "0xa53a997307000000f530997307000000395b99730700000000a5269107000000",
    "0x661f987307000000762798730700000000a52691070000005b2a987307000000",
  ],
  validatorBalanceProofs: [
    "0x6e79a073070000003d61a073070000003394a07307000000eb9ca07307000000f9f974a80bff0a6786767069e3c22b61cd92e250ab2fa37cd70d1c558d071e0b94d83d4ed130447a93bf8946266e456611af0540067ae6744ab05728a0f6c075c320ae0c7f08ae5624e0338449009d5f5baf0e5b9643090bc0e35441821b80986984a571c410b3d370ac1d2e26b121488a1ee9999516e29537d113d6292ea540322d723e273e8de2e43730b002c21c5814e4a4d4fcaf97f9876be2d79c02a6c7b26e288dcb1da222c4451186821bc5c46828135ae11a602f17a915e98e793891dbc019da728f7cd5a9038edf2b1e5503980690d3ffb9e421c1ec007944b143680eea4daae9f346fd8457e5c1073eb9fb572e86403d4f7d5bf28c1a4de97aae2263eef95b1d0abb68b2a1cac3495da39aab302eee3a2547da81f19600bd306a92e72e061d8ff0414611c322b24f03061932985771becae851d33eaf34294a9eebd41a6764734a3aa0d91f41c6c7793a2ef3383b44d382457e08da01296210e5bfcffb3e58c7726b57e42daa66a74ab904e44afc6841ec0ae7d77ff4d6c0752ab267e6fc70b8d4871328318eed6b289e64a109ef757fd2d81876e76ee6c76af11d42ff0f718a7afebf54a84adde2596572f97896df6e72e9d846ed51bc163d371ed49a7502ffcfb0340b1d7885688500ca308161a7f96b62df9d083b71fcc8f2bb8fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a42f2d168e28658e808f575a85f3a74336c67e0c80b4b92383546da77b118829ddcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a467657cdd2986268250628d0c10e385c58c6191e6fbe05191bcc04f133f2cea72c1c4848930bd7ba8cac54661072113fb278869e07bb8587f91392933374d017bcbe18869ff2c22b28cc10510d9853292803328be4fb0e80495e8bb8d271f5b889636b5fe28e79f1b850f8658246ce9b6a1e7b49fc06db7143e8fe0b4f2b0c5523a5c985e929f70af28d0bdd1a90a808f977f597c7c778c489e98d3bd8910d31ac0f7c6f67e02e6e4e1bdefb994c6098953f34636ba2b6ca20a4721d2b26a886722ff1c9a7e5ff1cf48b4ad1582d3f4e4a1004f3b20d8c5a2b71387a4254ad933ebc52f075ae229646b6f6aed19a5e372cf295081401eb893ff599b3f9acc0c0d3e7d328921deb59612076801e8cd61592107b5c67c79b846595cc6320c395b46362cbfb909fdb236ad2411b4e4883810a074b840464689986c3f8a8091827e17c32755d8fb3687ba3ba49f342c77f5a1f89bec83d811446e1a467139213d640b6a748d8e210000000000000000000000000000000000000000000000000000000000",
    "0xd9629d730700000026649d7307000000643f9d730700000071889d7307000000c78d64f9647fd45467c3045f6c14124d4e01f91eea94893915f02ebd06aeaa7a71458e41c1c95553a23badd65b3633709985c47222992bcd580ee3127e6c87c6531a4d2d8b27a1f18b831138c814d2c9552a5847dcf1ac1c07f7f403e3125c888c3707d36dc5cce04b06f8c0878c73367ee83bdff86192de5ea3d8f0c8629e52a6e457151cf12c3df988c96ecd31837ef62304447cbbecef5398018b29596e1b7f6511917fa05b91497b64b04b9071d496c2ee839a83f01c3377c59020ab19b0d08e5382cd2c2106faa75f5ce1925c38484459bd84ea2918964d63cb5dddc61ad4be71d35cd5bba9d0678929fab2c879b17f4d6d930cb746a145319f6bc2ccf84da1c71aa51549985a242b3c5e4e54e6d3f07bc5d0476c32ce84d02bc437d21e1c2ecf985a7beb65a3ed032fb078cfb30baf94505c1d8be7300bdb9719fd16d8fc8b400c7e5ff863815887a13b420d92f4b5fcc00217b8c97b19460f55e110c5cffb3e58c7726b57e42daa66a74ab904e44afc6841ec0ae7d77ff4d6c0752ab267e6fc70b8d4871328318eed6b289e64a109ef757fd2d81876e76ee6c76af11d42ff0f718a7afebf54a84adde2596572f97896df6e72e9d846ed51bc163d371ed49a7502ffcfb0340b1d7885688500ca308161a7f96b62df9d083b71fcc8f2bb8fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a42f2d168e28658e808f575a85f3a74336c67e0c80b4b92383546da77b118829ddcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a467657cdd2986268250628d0c10e385c58c6191e6fbe05191bcc04f133f2cea72c1c4848930bd7ba8cac54661072113fb278869e07bb8587f91392933374d017bcbe18869ff2c22b28cc10510d9853292803328be4fb0e80495e8bb8d271f5b889636b5fe28e79f1b850f8658246ce9b6a1e7b49fc06db7143e8fe0b4f2b0c5523a5c985e929f70af28d0bdd1a90a808f977f597c7c778c489e98d3bd8910d31ac0f7c6f67e02e6e4e1bdefb994c6098953f34636ba2b6ca20a4721d2b26a886722ff1c9a7e5ff1cf48b4ad1582d3f4e4a1004f3b20d8c5a2b71387a4254ad933ebc52f075ae229646b6f6aed19a5e372cf295081401eb893ff599b3f9acc0c0d3e7d328921deb59612076801e8cd61592107b5c67c79b846595cc6320c395b46362cbfb909fdb236ad2411b4e4883810a074b840464689986c3f8a8091827e17c32755d8fb3687ba3ba49f342c77f5a1f89bec83d811446e1a467139213d640b6a748d8e210000000000000000000000000000000000000000000000000000000000",
    "0xb77e99730700000031919973070000004d769973070000002888997307000000d02bb05b7a360b47b47089a4c46c1dc751bfc7455fba9f3b9b7c0dbda00a0ade3a16305ac8fdeff38b4c4a5b826ad7f84d3cd87b2f98c32a5b8d885680b7f1b5e7b934be1829de360901f0955f2ec575503ce73b24fe2a508065d6af6e5787d0b1f3ba3557f696ac5b06509cdc732d3a1f08174e45c515f030f89b99b74a9ce5c4a9eb72cbf99c62d6adc039752715f5be2f1424631042c144978be4e223a7c517b2177a24aec334b980cf174382e52ac48506ed9f8c3827a62b93eeeadc03eeb2e4b6098ab1b6cbfecc1539911e63f5c95eaa066d295d08e8b5365315257ae5cabfed97493d55e991675652e7aae50c00404f46e5abc649a3bfc803e113e1e4b1f9582a7881c3b926f559e49cacb1cd43f44760b6789748ffd17c01ca98ed5abf9d3e8450926ba2183a48b2419a8d8bc7702078ddd5f3863ea639e28348e16ca0304405e3dbaf1298b1881df2ddc8deface5aca4bf6e60db869e6b9d7f13bf3f78934fef79502e08e70ae283743d2eaa21d5dd25ca807db35e029001e303bfbe2324dff6da74cad13ea5a5ef64db35af2c26b92e62c90f52f7ddeeb52981c6fbddafe6d13f3b1e00c3f111d31b9ff99e0d535f686c5d6ffeac2674f9ee45043d49a7502ffcfb0340b1d7885688500ca308161a7f96b62df9d083b71fcc8f2bb8fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a42f2d168e28658e808f575a85f3a74336c67e0c80b4b92383546da77b118829ddcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a467657cdd2986268250628d0c10e385c58c6191e6fbe05191bcc04f133f2cea72c1c4848930bd7ba8cac54661072113fb278869e07bb8587f91392933374d017bcbe18869ff2c22b28cc10510d9853292803328be4fb0e80495e8bb8d271f5b889636b5fe28e79f1b850f8658246ce9b6a1e7b49fc06db7143e8fe0b4f2b0c5523a5c985e929f70af28d0bdd1a90a808f977f597c7c778c489e98d3bd8910d31ac0f7c6f67e02e6e4e1bdefb994c6098953f34636ba2b6ca20a4721d2b26a886722ff1c9a7e5ff1cf48b4ad1582d3f4e4a1004f3b20d8c5a2b71387a4254ad933ebc52f075ae229646b6f6aed19a5e372cf295081401eb893ff599b3f9acc0c0d3e7d328921deb59612076801e8cd61592107b5c67c79b846595cc6320c395b46362cbfb909fdb236ad2411b4e4883810a074b840464689986c3f8a8091827e17c32755d8fb3687ba3ba49f342c77f5a1f89bec83d811446e1a467139213d640b6a748d8e210000000000000000000000000000000000000000000000000000000000",
    "0xde3a9873070000007e9c38c034000000b82898730700000066ca97730700000092f26188d26035c476de7bc06f330e15b2b0ac906cf4f417a54b57c4546cfa77cbe9660eebbedffed2811e7abba791cffb013dea1499353940acf83acdcdbdc1bb66f78480ea569b96f7f87db41e184a31349f10980f40bb8911dee3ba264451b8e70214ff1abbf8c8d925934d5643778b48f5fe18fd1203a2fac5cdb24c547ecd2b53f340ba403acf614723908627d8f7b27905cbe379c553c564fbc7f421ff88e6d0c0a419a1eda6cbe6149e5c5450bcc733dc52b3491f52c9705bbd7508fbafdfbd5caf880a7c556cf52e240d9230d5ab9f14161a8ac3ca8d7a2594dbea5db9a8b250f8edd510c4cb52956ce77c158609cb694ceafa4593ea20b41a8c097dfc8c17126489572c19497e1edd06ca9472d39a6cd018cf2621ddc2befc6385f14ba9aae0bc35029a77d73049555db9826f4b56b4bde27a758dc7180a9a8fd290acbf1b791a21e9c674ba9283fc110cf75f7163cec145020a03a38efc996285017666282c018fa814679cd14596fc910ee78ba0f8ecece15a0563b6718fcfa045e2324dff6da74cad13ea5a5ef64db35af2c26b92e62c90f52f7ddeeb52981c6fbddafe6d13f3b1e00c3f111d31b9ff99e0d535f686c5d6ffeac2674f9ee45043d49a7502ffcfb0340b1d7885688500ca308161a7f96b62df9d083b71fcc8f2bb8fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a42f2d168e28658e808f575a85f3a74336c67e0c80b4b92383546da77b118829ddcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a467657cdd2986268250628d0c10e385c58c6191e6fbe05191bcc04f133f2cea72c1c4848930bd7ba8cac54661072113fb278869e07bb8587f91392933374d017bcbe18869ff2c22b28cc10510d9853292803328be4fb0e80495e8bb8d271f5b889636b5fe28e79f1b850f8658246ce9b6a1e7b49fc06db7143e8fe0b4f2b0c5523a5c985e929f70af28d0bdd1a90a808f977f597c7c778c489e98d3bd8910d31ac0f7c6f67e02e6e4e1bdefb994c6098953f34636ba2b6ca20a4721d2b26a886722ff1c9a7e5ff1cf48b4ad1582d3f4e4a1004f3b20d8c5a2b71387a4254ad933ebc52f075ae229646b6f6aed19a5e372cf295081401eb893ff599b3f9acc0c0d3e7d328921deb59612076801e8cd61592107b5c67c79b846595cc6320c395b46362cbfb909fdb236ad2411b4e4883810a074b840464689986c3f8a8091827e17c32755d8fb3687ba3ba49f342c77f5a1f89bec83d811446e1a467139213d640b6a748d8e210000000000000000000000000000000000000000000000000000000000",
  ],
};
const pendingDepositProofs = {
  pendingDepositContainerRoot:
    "0x1569283d34597682dc23df5d7d810741423a982dba2894e7c91a0500523fe02f",
  pendingDepositContainerProof:
    "0xa60a4d51806f867a41eef3270b5ffb01887ea65cf77271331306ba85f050048b118a5c45359c979999bcac5171498a35bb6439765ea29d9f10562c192c13ae796428ec097c86205afcc2e69f57dc61514a5307a7e3b424ab5333ed4639253256c78009fdf07fc56a11f122370658a353aaa542ed63e44c4bc15ff4cd105ab33c536d98837f2dd165a55d5eeae91485954472d56f246df256bf3cae19352a123c1f28c2577676765761bec84e902fc00f197ab7fbfe3caf3cb00b1d7d20aeb1e1d9c23ad502758c52d175f6d58baaf83b853558e11930df26cdf5305702b90fa191e7ef00c1b8963aaa0798ff7b23f54c142f4778757bfd40e47048935ec2db45c3b54249619b043128fe7460f5608f44f1c76135abb223b5e4aafee8e6d5b0b7",
  pendingDepositIndexes: [
    "14592",
    "18641",
    "18654",
    // "18655",
    "42817",
    "18656",
    "35285",
    "42812",
    "42814",
    "42815",
    "42816",
  ],
  pendingDepositProofs: [
    "0xc34fff8478db7d3bcdfa064f5620abc7f87efc0ece599a0ebc234493e4a6c0f7a3fca46f27005d5e08cbe601ee7529043fb88f46b046a2b37a6faec7d92932f78daff34b76dbe62def8dfbf54d17adbdc1243db4167f129513fb3b9e0b1d7ef9e1cbac8158d3087f520cd5459a3b0db6113269d020e7f40772c33521a557a63122c16bb638cd7b8b2cc3b5c1c26f0be4ea144717878c8d774507d74b851816e5315fa1dfe6b9bb9c27209771789e90f7e6fbc490ed964b5552e8c22e4d907b256580598512a4db0eb0e4c6cef62742d52c47f1e44646e5a8e79ea3fdfa51c3ae852c72a6a97944f77d37ee51ff79416849c72a3a2c61f86ec599e94a85864e5283c59a9cbe6cb402b9d6d48d20a38ac28e47f3243652b5d1658b9cd25ccf9da03553442b0fb9ea1c77f2839f3e8eb359c2e87f5c09db49a10ea2015e03ae16f2792fabb75492d055819a7d8e4514e66c5ce14208bee1279a9a02e2cb8b0ffe454ae4017ed96ce26ffc9ae3cc2f1fce9d79597798532f6df2893363f3f7633eca880fde3f6a4137c917afc4104d5d8f33bcf271da1090d81b09e09077c8be5d4e3e7f23d01ce85ade307fa12acfa6112ba7e60a9159a23c15d00d7c6b9427f6630fa1cb5a50c072572e12b3009f555ab1ed4a90cf6aa6b3e3ffa0156260e687b5312e49477bb59d3016819e9adcb853b6371bc146c84b482fab3414fd5f4612688fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
    "0xd98c9a9c84ff39129af4c465a360954ef94e76839a04354e57a1e7ef70ffe3eaa6dc8f3bbf7727f23d669cb37b7a25915b6e3e64f62aa817620e237a8b1d6c05d2575e68e5d2e8142e6311090237b07f9ca7d2e6a79f34752a98298a167774ba7b6d6b065c3b016f4ca962b544a59988981736024e1e14ece3c8de665ebddee5d4f4c56882e543b8352f8ecc371b39467f3f7a660e8e41d9e918e6ecd20c1eacf1b45620abc0f8f2bee0917fd48101ae5b629b50a23afa76b409de0a54f6f51a054db1ada756bc37669859c7a309be6c8bbc1d05109e8e51bc8d635e3f57a38348f6ae4433379f2cd415a9ddd52bff62e88dba00281c8e51de4b57d0636aa5b277da6d4d23dd92f1e71e3b671ca3c45b47649a049376c461d9f0d19679d33dd4839f5f2152af17116cfadc4382a7f7626d4840394227a3cc44108d5584dc20b0bccaafc30d905fd95026d1d420e485bcb4b9d5436a15e30a07c13edd66abb77dd931fb819fdc6461cbbaa93e8982663d4b903a26cd3ca1891758e91a8c5702bec749228cb8174b260f8ef7e4c0a56409a5df0ead649a5a664c4ab5479bbd4237efd3162264f690aa3916c2c5262ac3e65f933ca2ac585840abe071514f3944c37011fe9710afb2674b9b238ee6e7a1e264244ea047c87ee47f3b51e36850633b312e49477bb59d3016819e9adcb853b6371bc146c84b482fab3414fd5f4612688fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
    "0x78064553d435f3967fac15770e814581d47ff07d01f38e35450cb0c45fc17caec27075fdee7f613c814ed44eef6c6059ed7f56290c62176aa2886fdd3c9c52cd715d7f7cd06b8aea6a345558abca48f6c5d9cc3ffc5155d6330266fdbe42b26ed86185ec784e73ff76d302b6646deffb2b4cdf0a7efb5c2f82d860b20447d430d4f4c56882e543b8352f8ecc371b39467f3f7a660e8e41d9e918e6ecd20c1eacf1b45620abc0f8f2bee0917fd48101ae5b629b50a23afa76b409de0a54f6f51a054db1ada756bc37669859c7a309be6c8bbc1d05109e8e51bc8d635e3f57a38348f6ae4433379f2cd415a9ddd52bff62e88dba00281c8e51de4b57d0636aa5b277da6d4d23dd92f1e71e3b671ca3c45b47649a049376c461d9f0d19679d33dd4839f5f2152af17116cfadc4382a7f7626d4840394227a3cc44108d5584dc20b0bccaafc30d905fd95026d1d420e485bcb4b9d5436a15e30a07c13edd66abb77dd931fb819fdc6461cbbaa93e8982663d4b903a26cd3ca1891758e91a8c5702bec749228cb8174b260f8ef7e4c0a56409a5df0ead649a5a664c4ab5479bbd4237efd3162264f690aa3916c2c5262ac3e65f933ca2ac585840abe071514f3944c37011fe9710afb2674b9b238ee6e7a1e264244ea047c87ee47f3b51e36850633b312e49477bb59d3016819e9adcb853b6371bc146c84b482fab3414fd5f4612688fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
    // "0xf3d2b82cf422ce4c080a3cf85eeb154d9dac080d401df3f8fb2cc26bddd348b7c27075fdee7f613c814ed44eef6c6059ed7f56290c62176aa2886fdd3c9c52cd715d7f7cd06b8aea6a345558abca48f6c5d9cc3ffc5155d6330266fdbe42b26ed86185ec784e73ff76d302b6646deffb2b4cdf0a7efb5c2f82d860b20447d430d4f4c56882e543b8352f8ecc371b39467f3f7a660e8e41d9e918e6ecd20c1eacf1b45620abc0f8f2bee0917fd48101ae5b629b50a23afa76b409de0a54f6f51a054db1ada756bc37669859c7a309be6c8bbc1d05109e8e51bc8d635e3f57a38348f6ae4433379f2cd415a9ddd52bff62e88dba00281c8e51de4b57d0636aa5b277da6d4d23dd92f1e71e3b671ca3c45b47649a049376c461d9f0d19679d33dd4839f5f2152af17116cfadc4382a7f7626d4840394227a3cc44108d5584dc20b0bccaafc30d905fd95026d1d420e485bcb4b9d5436a15e30a07c13edd66abb77dd931fb819fdc6461cbbaa93e8982663d4b903a26cd3ca1891758e91a8c5702bec749228cb8174b260f8ef7e4c0a56409a5df0ead649a5a664c4ab5479bbd4237efd3162264f690aa3916c2c5262ac3e65f933ca2ac585840abe071514f3944c37011fe9710afb2674b9b238ee6e7a1e264244ea047c87ee47f3b51e36850633b312e49477bb59d3016819e9adcb853b6371bc146c84b482fab3414fd5f4612688fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
    "0xb052e26ca38ea7d23a9d8e2b4e0930caec9762902558a0c69a6165d2b34225ceb952f1c1498e677bc53c02cbc5508746390ee5fe28ac78bb3269e3d508f26cb59cee7306db15b383b855e646ac37b0037cb71362f1d6d572080e23f4774cba5b83729aa771eef156624149b21cc655b1488a5d57d6bce4e10b93f5172eeb54731f5d33a55787852d3b1eecc7fb0c066d055b7b39c33b2ff209ec1ef5dd2645e3f4823e7cd8705b6e071b9a6c1e2f03a5f526aae52320ed0a47059c65f119d1a17f42fa6b8a8ab1e90adf86a48397eed6926f631596053f591befeb78b7bce41dbf72cb7943c7c59edd04b8f76160f3ce886a13706747047a83a7776a8215b104c90ce5e1fe6d0bde131ab5ecc1b711d7985281eca4e8a1af2769bd5cf6ef9c144c94a31e5bd4250f9581a65fe2fd5f7d50376a14c30d6ba56e02b806f1db61d3009f2a7742dc822473ab080134a0a7ef13a44c7d657d8eaba02ed5cc9fdd814617a608e510334d3112f80398e8650333342c623260139a0143aa59b31abb4348b7d05f875f140027ef5118a2247bbb84ce8f2f0f1123623085daf7960c329f5f339eebeac8b5a6dcaa2a8be7227579f7b9654cbff561a6aa52648171fdff2861b58d900f5e182e3c50ef74969ea16c7726c549757cc23523c369587da7293784334389ca1621fcc084f1855c0c04827935652cbdcc1b4a1fd86bac1043eb66138fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
    "0x5d4ccd48749dab4278da9cdac6c4307647c9287f533d3d356e68c4ee98fb0a46e8c5f7210f713ab37dbf19ecd3b8b9a7efb14416de0d3fa3e663e9bd0675de0e151c24b9083561527aef588aed23ce467699f1120fb8864322ec6227fafe777c5d59607058d300335b3fadbfe7a836122a6a61dd52be457a2fd343c76770f9b04bff6e9528399b0b7fdfd0933fefabb68f8b21f90c198a8a65e5b6094994500ceb9ba8d26bb5ff57bc9f8cb8437dee73e4953aa2bafe217f80646a5246616896054db1ada756bc37669859c7a309be6c8bbc1d05109e8e51bc8d635e3f57a38348f6ae4433379f2cd415a9ddd52bff62e88dba00281c8e51de4b57d0636aa5b277da6d4d23dd92f1e71e3b671ca3c45b47649a049376c461d9f0d19679d33dd4839f5f2152af17116cfadc4382a7f7626d4840394227a3cc44108d5584dc20b0bccaafc30d905fd95026d1d420e485bcb4b9d5436a15e30a07c13edd66abb77dd931fb819fdc6461cbbaa93e8982663d4b903a26cd3ca1891758e91a8c5702bec749228cb8174b260f8ef7e4c0a56409a5df0ead649a5a664c4ab5479bbd4237efd3162264f690aa3916c2c5262ac3e65f933ca2ac585840abe071514f3944c37011fe9710afb2674b9b238ee6e7a1e264244ea047c87ee47f3b51e36850633b312e49477bb59d3016819e9adcb853b6371bc146c84b482fab3414fd5f4612688fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
    "0xcf0e9204a7384274c77ca593765bdb8977559a06ccef58b97cce1ea31de7ec5a5b61a2cd6171697d878b6c178c6a8a180fc24c1b2ee433d66bee4129e2fb2a1fcd03fb13dfa90c6ba0323a71b8f7458faa3bf5f57747b1757966625f9b5cecc38b4b5efb7d0401573d4b89eea1f5738f376ef80150c558f3cc05629be8ee935a9c6e1dd8e5b3386813d41822cdbb3178a53884979620df900cb63eec56eb23809173ec8acfba0f4111df1b408826859e9da75cb2899653c13cacbdd9a7398bf910de7c9c141ac086a8257fb7b8c68c725d7d477b1c45fc556c1665a6c92f5c23155ab64148050f5bcdc0bf48a1b8d13ca78e879096d3f742864d13c210aeab95dd2571ca852b08666160c93b9bbba9b4d371b97d1a17539b2959f5be7cb0619f63cfa12bdf7b64e69bfaf0600143b773d03921ac7f01ff77e6206eff4a113fe6b9be8fbf22328b8b2d76364813440c320b252e74672b69a3f158452736237c74219567d9d9d30ad143ad66caa1bd66dfb32337bf10b96c0fc9b279b0c89ff1ff891f2095fdf76e6d58f76c4d453b996653d9b09222147c62dffeffc6d4e1932e46f2945ad7014eb8473a29b9c0f94a4b2f61536afcdc6facdde1ec91c4c4c7d3b58d900f5e182e3c50ef74969ea16c7726c549757cc23523c369587da7293784334389ca1621fcc084f1855c0c04827935652cbdcc1b4a1fd86bac1043eb66138fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
    "0x308dba54c2444e4683aa4c92c423532dae274d39dc0a95a2871b90006b41a357ad345f10252274408791763ea728c60cfd0c0e4b830a4478358e903ea5fb8e9d47fcd7bf440d62e8031f4585781fdd8a3b8f29c2d82c881af4741fd598a64b9ac890a21e659109ef7b6b84ec60714d1d443075f277d180275e88fc3c17653a5d036bbd350e68ea77b980f450ef888c3d179557bb9de0ec4587213bc7977cf2959269b860abf8016a8ae51aa4d53da0d2d284bb2dfaef0dc56a4a554ee9138ade92482e73817c7525b477566ab0c97d998dd6ce7ed099fbecf167e397921dd6e8bf72cb7943c7c59edd04b8f76160f3ce886a13706747047a83a7776a8215b104c90ce5e1fe6d0bde131ab5ecc1b711d7985281eca4e8a1af2769bd5cf6ef9c144c94a31e5bd4250f9581a65fe2fd5f7d50376a14c30d6ba56e02b806f1db61d3009f2a7742dc822473ab080134a0a7ef13a44c7d657d8eaba02ed5cc9fdd814617a608e510334d3112f80398e8650333342c623260139a0143aa59b31abb4348b7d05f875f140027ef5118a2247bbb84ce8f2f0f1123623085daf7960c329f5f339eebeac8b5a6dcaa2a8be7227579f7b9654cbff561a6aa52648171fdff2861b58d900f5e182e3c50ef74969ea16c7726c549757cc23523c369587da7293784334389ca1621fcc084f1855c0c04827935652cbdcc1b4a1fd86bac1043eb66138fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
    "0x5884a4ac9f90f068ebec13e3be02253bc0f44b196572038dd09e77edf8ec0d5d9419046f0790d907a2d00e8a8550a1cf671b4d41eed19837d6c767ce094d5ec247fcd7bf440d62e8031f4585781fdd8a3b8f29c2d82c881af4741fd598a64b9ac890a21e659109ef7b6b84ec60714d1d443075f277d180275e88fc3c17653a5d036bbd350e68ea77b980f450ef888c3d179557bb9de0ec4587213bc7977cf2959269b860abf8016a8ae51aa4d53da0d2d284bb2dfaef0dc56a4a554ee9138ade92482e73817c7525b477566ab0c97d998dd6ce7ed099fbecf167e397921dd6e8bf72cb7943c7c59edd04b8f76160f3ce886a13706747047a83a7776a8215b104c90ce5e1fe6d0bde131ab5ecc1b711d7985281eca4e8a1af2769bd5cf6ef9c144c94a31e5bd4250f9581a65fe2fd5f7d50376a14c30d6ba56e02b806f1db61d3009f2a7742dc822473ab080134a0a7ef13a44c7d657d8eaba02ed5cc9fdd814617a608e510334d3112f80398e8650333342c623260139a0143aa59b31abb4348b7d05f875f140027ef5118a2247bbb84ce8f2f0f1123623085daf7960c329f5f339eebeac8b5a6dcaa2a8be7227579f7b9654cbff561a6aa52648171fdff2861b58d900f5e182e3c50ef74969ea16c7726c549757cc23523c369587da7293784334389ca1621fcc084f1855c0c04827935652cbdcc1b4a1fd86bac1043eb66138fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
    "0xac9a98d48b7b13938bbf6c50c07b7d9f41c78c2dc9515280ec3cab9209ac44ba9419046f0790d907a2d00e8a8550a1cf671b4d41eed19837d6c767ce094d5ec247fcd7bf440d62e8031f4585781fdd8a3b8f29c2d82c881af4741fd598a64b9ac890a21e659109ef7b6b84ec60714d1d443075f277d180275e88fc3c17653a5d036bbd350e68ea77b980f450ef888c3d179557bb9de0ec4587213bc7977cf2959269b860abf8016a8ae51aa4d53da0d2d284bb2dfaef0dc56a4a554ee9138ade92482e73817c7525b477566ab0c97d998dd6ce7ed099fbecf167e397921dd6e8bf72cb7943c7c59edd04b8f76160f3ce886a13706747047a83a7776a8215b104c90ce5e1fe6d0bde131ab5ecc1b711d7985281eca4e8a1af2769bd5cf6ef9c144c94a31e5bd4250f9581a65fe2fd5f7d50376a14c30d6ba56e02b806f1db61d3009f2a7742dc822473ab080134a0a7ef13a44c7d657d8eaba02ed5cc9fdd814617a608e510334d3112f80398e8650333342c623260139a0143aa59b31abb4348b7d05f875f140027ef5118a2247bbb84ce8f2f0f1123623085daf7960c329f5f339eebeac8b5a6dcaa2a8be7227579f7b9654cbff561a6aa52648171fdff2861b58d900f5e182e3c50ef74969ea16c7726c549757cc23523c369587da7293784334389ca1621fcc084f1855c0c04827935652cbdcc1b4a1fd86bac1043eb66138fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
    "0xe43aa97c7b45d686240e148893fb944692f4a5513afca99a351c1f20e26c5597b952f1c1498e677bc53c02cbc5508746390ee5fe28ac78bb3269e3d508f26cb59cee7306db15b383b855e646ac37b0037cb71362f1d6d572080e23f4774cba5b83729aa771eef156624149b21cc655b1488a5d57d6bce4e10b93f5172eeb54731f5d33a55787852d3b1eecc7fb0c066d055b7b39c33b2ff209ec1ef5dd2645e3f4823e7cd8705b6e071b9a6c1e2f03a5f526aae52320ed0a47059c65f119d1a17f42fa6b8a8ab1e90adf86a48397eed6926f631596053f591befeb78b7bce41dbf72cb7943c7c59edd04b8f76160f3ce886a13706747047a83a7776a8215b104c90ce5e1fe6d0bde131ab5ecc1b711d7985281eca4e8a1af2769bd5cf6ef9c144c94a31e5bd4250f9581a65fe2fd5f7d50376a14c30d6ba56e02b806f1db61d3009f2a7742dc822473ab080134a0a7ef13a44c7d657d8eaba02ed5cc9fdd814617a608e510334d3112f80398e8650333342c623260139a0143aa59b31abb4348b7d05f875f140027ef5118a2247bbb84ce8f2f0f1123623085daf7960c329f5f339eebeac8b5a6dcaa2a8be7227579f7b9654cbff561a6aa52648171fdff2861b58d900f5e182e3c50ef74969ea16c7726c549757cc23523c369587da7293784334389ca1621fcc084f1855c0c04827935652cbdcc1b4a1fd86bac1043eb66138fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
  ],
};

describe("ForkTest: Consolidation of Staking Strategies", function () {
  this.timeout(0);

  let fixture;
  let nativeStakingStrategy2;
  let nativeStakingStrategy3;
  let compoundingStakingStrategy;
  let consolidationController;
  let adminSigner;
  let registratorSigner;

  beforeEach(async () => {
    fixture = await loadFixture();
    nativeStakingStrategy2 = await resolveContract(
      "NativeStakingSSVStrategy2Proxy",
      "NativeStakingSSVStrategy"
    );
    nativeStakingStrategy3 = await resolveContract(
      "NativeStakingSSVStrategy3Proxy",
      "NativeStakingSSVStrategy"
    );
    compoundingStakingStrategy = await resolveContract(
      "CompoundingStakingSSVStrategyProxy",
      "CompoundingStakingSSVStrategy"
    );
    registratorSigner = await impersonateAndFund(
      addresses.mainnet.validatorRegistrator
    );
    adminSigner = await impersonateAndFund(addresses.mainnet.Guardian);
    consolidationController = await resolveContract("ConsolidationController");
  });

  const activateTargetValidators = async (fixture) => {
    const { beaconRoots } = fixture;

    // 1. Verify the deposit to the target validator so it becomes Active
    const pendingDepositRoot =
      "0x78064553d435f3967fac15770e814581d47ff07d01f38e35450cb0c45fc17cae";
    const depositProofs = {
      firstPendingDeposit: {
        slot: 18819379,
        proof:
          "0x0000000000000000000000000000000000000000000000000000000000000000f5a5fd42d16a20302798ef6ed309979b43003d2320d9f0e8ea9831a92759fb4b488433761da1faf45c9ecd379370ffe5916157fa4efa1f9f8d0c7a68c3182242a1ba21e0229abe6e4d703fa718a7ca2bb47f339782823adf66b851482c17a9c4633ab0630569adcea3b51d2dd5688ea3cc5fcac0077e4cedc2b762ed20927a6fd28abb67dedfbb13b51c7b9e1fb7edf5ee19928f4a87782fd90a988ac1cbbd0bd6575088af12fbd67398d98ea6c5e8bc703a967dfad707f1f81c3cbcec71097bf04ac6c590a35901522f1162f2dd3c96aa86cc720653b37d4cdce9b7fbfa2567fa2f99ee7bf5da7df1bfd244cfb006eec07987cae586efa3d13dca371c3d6ed75d7b4d264f3b70daac0a5849cba620cfa6fb97a02baa83379dae48bbf383d94c57762d23d2c7cc173f353a444542abd532abe1dcdc41e6fb45268c0f5003c08f311e676d60b00c1c0045bb929144dd1e0fb8657ea6c3b5645565bc5952395df9ef541cd820e82540899d51f88c6019a9b6f5ae6bba6bec5bdd64a24e527bb87c6fa9a2a71c02a76c9297d19acb080c7f5bfdfb51cc5892db53c64943b8bb0398989b6f4032f4af1f3ca499ef016d91c072b9f014023bc0446e4f6919449a3d76880d4c88d8ae7393086eb1265b37d57d0702ae653f6897fc44d4467175969473a01f52d3f59e3d63b36ef0916197c82d18f252abce49965df8a6197a2014972ff931ccaaaec886819a87c62ce5f83c562a088bf4f6884e698d22aad234cbfa37b2d6f24ef16b7d610401977e6cda9c7e0bf5e39d9ba420ae9e237d7a6bcf91de8fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676502a4000000000000000000000000000000000000000000000000000000000000670b7aa9f61270fa6ccad04f8cd8a5f8cc71eb4876783fa54f8225ce0087d1563dc7babdd64f232a41e45aca37953a55ab14be47661c4b26bae33ff20d321c2470c9278176489df3c074abe583909e9d6b57d78563087e978d4d0ba41795b3c7c78009fdf07fc56a11f122370658a353aaa542ed63e44c4bc15ff4cd105ab33c536d98837f2dd165a55d5eeae91485954472d56f246df256bf3cae19352a123c70163fbe26a0fe183a33721e27768c4d087c41856d337912817381e963e61f4c118c1b711faafc66713f508587bfb9acca244bd684774e79a0586deef14f9beaf8d83b19af3ec3c9aa66f14dff480d26290572453f306e5ca4d1f045bcbe126458ce50890b160491aa56283b06563381a602d3303ba6b0d01dbee462499d92cb",
      },
      strategyValidator: {
        withdrawableEpoch: "18446744073709551615",
        withdrawableEpochProof:
          "0xffffffffffffffff000000000000000000000000000000000000000000000000520cc47c38af7c1a550b6f04a1de72582ceebd40bb079dfb08d97d3849da57de5adf0d67aada66648eb16735ee94b3072d3e51089fc055cbed4f83deb04920e66fd3d5b491f8e01dcc16ae28ed83ea7e886e98441c54683afa82077f603159228f49415c2f4721fc768f96a2dd1b2b1ad878991d41e6860294272d0fd2676a31128c71d66a18a694d57d6d5ae00429f708645d331679f2725ce3ca72000b5d907e6dffb1a86f28817d276ddffb9bd1a2b93a47e4d0dd0d75dc99cb4c1663a66ddbf2d7057b4617986deaf899b69022e52f4bf71da895bf17a41e309d51ac606564f69990eee0c920cbb35356b60773be81d2b78ba07562429a0ba3aa4667632307da7890c1471301e45ffa789711b65f7d2af7d3938c9a827d9afed9274e1b1ce768bb92d8a2cbf150adc0493cab89a0cb4124b6a2a9d77dccc46c7f67a47c03a3f4d0c7eb2158a4b5e2d0d974305d2d47b81179475e441f7cd57ea48354f24306c43d74dc1ac499e8ed8b23f09b95ac2a73e8d7b990fcad2470dfb46fcbbdddad148590d97070c7f2dfc63a6164c7a7ef999ac94189a9d6f52d6759115c67c7e65bce08d115165d11bf8e92fdaa3c26555f018f4ad9636fbc13fe57c60f99847e341de148a947ab32f730c4fc234343bb4e7dace59e00ba7442afa80882af5132c15e0937942b2f1d6240227661a536bbd079f406f38aa77a99cc28c2d274a30bbb48cf4622271afaea2f4e4968be4ef42736d7305452627cf0c38480ae59694f6e782a2faf0adb907749ab171b4a7f260e07e2a655198e3b88bc4ded5d07bd168ba9f0d826ed4630be89c7f53e067093bcc3a0d18c38fb37c284eadca114e68d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaab2291dc610ded7da1e5513f149afb44b93bff4e6dcb0935a1007a4b576620c3dfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a467657cdd2986268250628d0c10e385c58c6191e6fbe05191bcc04f133f2cea72c1c4848930bd7ba8cac54661072113fb278869e07bb8587f91392933374d017bcbe18869ff2c22b28cc10510d9853292803328be4fb0e80495e8bb8d271f5b889636b5fe28e79f1b850f8658246ce9b6a1e7b49fc06db7143e8fe0b4f2b0c5523a5c985e929f70af28d0bdd1a90a808f977f597c7c778c489e98d3bd8910d31ac0f7c6f67e02e6e4e1bdefb994c6098953f34636ba2b6ca20a4721d2b26a886722ff1c9a7e5ff1cf48b4ad1582d3f4e4a1004f3b20d8c5a2b71387a4254ad933ebc52f075ae229646b6f6aed19a5e372cf295081401eb893ff599b3f9acc0c0d3e7d328921deb59612076801e8cd61592107b5c67c79b846595cc6320c395b46362cbfb909fdb236ad2411b4e4883810a074b840464689986c3f8a8091827e17c32755d8fb3687ba3ba49f342c77f5a1f89bec83d811446e1a467139213d640b6a74f7210d4f8e7e1039790e7bf4efa207555a10a6db1dd4b95da313aaa88b88fe76ad21b516cbc645ffe34ab5de1c8aef8cd4e7f8d2b51e8e1456adc7563cda206f6288210000000000000000000000000000000000000000000000000000000000c6341f0000000000000000000000000000000000000000000000000000000000c3eebb66d1773a407990ed0f85624b0371733c9876ac0b5f3b31a10c7c76742dfa93a180bb0f287cf9fd7d37aeb16ab58d2237837b155005b5eb4b40c8956fce933f0a82f86b96fba65cde6463518f01021a9c233ba66b2d5379bf89e26edd0281b17309e3100490fd577aac90437622435b8e04542dafd6e7014594250bd0c9205a0fa5e7c54a345c6046cd7a1b1f19fa499f6eeee54155591686d85774a5c8118c1b711faafc66713f508587bfb9acca244bd684774e79a0586deef14f9beaf8d83b19af3ec3c9aa66f14dff480d26290572453f306e5ca4d1f045bcbe126458ce50890b160491aa56283b06563381a602d3303ba6b0d01dbee462499d92cb",
      },
      processedBeaconBlockRoot:
        "0x342e7b37fa2b16afb4edad685b23bd3092db388d344c6e88d1fa4cb70a6ecebb",
    };

    // Set BeaconRoot for timestamp
    let nextBlockTimestamp = calcBlockTimestamp(
      depositProofs.firstPendingDeposit.slot + 1
    );
    await beaconRoots["setBeaconRoot(uint256,bytes32)"](
      nextBlockTimestamp,
      depositProofs.processedBeaconBlockRoot
    );

    await compoundingStakingStrategy
      .connect(registratorSigner)
      .verifyDeposit(
        pendingDepositRoot,
        depositProofs.firstPendingDeposit.slot,
        depositProofs.firstPendingDeposit,
        depositProofs.strategyValidator
      );

    // Get the current block timestamp
    await advanceTime(12);
    const { timestamp: currentTimestamp } = await ethers.provider.getBlock(
      "latest"
    );
    nextBlockTimestamp = currentTimestamp;
    await beaconRoots["setBeaconRoot(uint256,bytes32)"](
      // I can't control the timestamp with Hardhat
      nextBlockTimestamp + 2,
      "0x67d077e55a1f4af124a8df1e1ac720d1e1e557a5305d774c5ebf98be3479cf8d"
    );

    await compoundingStakingStrategy.connect(registratorSigner).snapBalances();

    await consolidationController
      .connect(registratorSigner)
      .verifyBalances(balanceProofs, pendingDepositProofs);
  };

  describe("When no consolidation in progress", () => {
    beforeEach(async () => {
      await activateTargetValidators(fixture);
    });
    it("Should request consolidation of a single validator from the second cluster", async () => {
      const sourceValidators = [secondClusterPubKeys[0]];

      // Source validator pre-conditions
      expect(
        await nativeStakingStrategy2.validatorsStates(
          keccak256(sourceValidators[0])
        )
      ).to.equal(2); // STAKED state

      // Target validator pre-conditions
      const targetPubKeyHash = hashPubKey(activeTargetPubKey);
      const validatorData = await compoundingStakingStrategy.validator(
        targetPubKeyHash
      );
      expect(validatorData.state).to.equal(4); // Active status

      const tx = await consolidationController
        .connect(adminSigner)
        .requestConsolidation(
          nativeStakingStrategy2.address,
          sourceValidators,
          activeTargetPubKey,
          { value: 1 }
        );

      // Assert source strategy
      await expect(tx)
        .to.emit(nativeStakingStrategy2, "ConsolidationRequested")
        .withArgs(sourceValidators, activeTargetPubKey, 1);
      expect(
        await nativeStakingStrategy2.validatorsStates(
          keccak256(sourceValidators[0])
        )
      ).to.equal(3); // EXITING state
    });
    it("Should request consolidation of multiple validators from the second cluster", async () => {
      const sourceValidators = [
        secondClusterPubKeys[0],
        secondClusterPubKeys[1],
      ];

      // Source validator pre-conditions
      expect(
        await nativeStakingStrategy2.validatorsStates(
          keccak256(sourceValidators[1])
        )
      ).to.equal(2); // STAKED state

      // Target validator pre-conditions
      const targetPubKeyHash = hashPubKey(activeTargetPubKey);
      const validatorData = await compoundingStakingStrategy.validator(
        targetPubKeyHash
      );
      expect(validatorData.state).to.equal(4); // Active status

      const tx = await consolidationController
        .connect(adminSigner)
        .requestConsolidation(
          nativeStakingStrategy2.address,
          sourceValidators,
          activeTargetPubKey,
          { value: 2 }
        );

      // Assert source strategy
      await expect(tx)
        .to.emit(nativeStakingStrategy2, "ConsolidationRequested")
        .withArgs(sourceValidators, activeTargetPubKey, 2);
      expect(
        await nativeStakingStrategy2.validatorsStates(
          keccak256(sourceValidators[0])
        )
      ).to.equal(3); // EXITING state
      expect(
        await nativeStakingStrategy2.validatorsStates(
          keccak256(sourceValidators[1])
        )
      ).to.equal(3); // EXITING state
    });
    it("Should request consolidation of a lot of validators from the second cluster", async () => {
      expect(
        await nativeStakingStrategy2.validatorsStates(
          keccak256(secondClusterPubKeys[37])
        )
      ).to.equal(2); // STAKED state

      // Target validator pre-conditions
      const targetPubKeyHash = hashPubKey(activeTargetPubKey);
      const validatorData = await compoundingStakingStrategy.validator(
        targetPubKeyHash
      );
      expect(validatorData.state).to.equal(4); // Active status

      const tx = await consolidationController
        .connect(adminSigner)
        .requestConsolidation(
          nativeStakingStrategy2.address,
          secondClusterPubKeys,
          activeTargetPubKey,
          { value: secondClusterPubKeys.length }
        );

      // Assert source strategy
      await expect(tx)
        .to.emit(nativeStakingStrategy2, "ConsolidationRequested")
        .withArgs(
          secondClusterPubKeys,
          activeTargetPubKey,
          secondClusterPubKeys.length
        );
      expect(
        await nativeStakingStrategy2.validatorsStates(
          keccak256(secondClusterPubKeys[37])
        )
      ).to.equal(3); // EXITING state
    });
    it("Should request consolidation of a lot of validators from the third cluster", async () => {
      expect(
        await nativeStakingStrategy3.validatorsStates(
          keccak256(thirdClusterPubKeys[0])
        )
      ).to.equal(2); // STAKED state

      // Target validator pre-conditions
      const targetPubKeyHash = hashPubKey(activeTargetPubKey);
      const validatorData = await compoundingStakingStrategy.validator(
        targetPubKeyHash
      );
      expect(validatorData.state).to.equal(4); // Active status

      const tx = await consolidationController
        .connect(adminSigner)
        .requestConsolidation(
          nativeStakingStrategy3.address,
          thirdClusterPubKeys,
          activeTargetPubKey,
          { value: thirdClusterPubKeys.length }
        );

      // Assert source strategy
      await expect(tx)
        .to.emit(nativeStakingStrategy3, "ConsolidationRequested")
        .withArgs(
          thirdClusterPubKeys,
          activeTargetPubKey,
          thirdClusterPubKeys.length
        );
      expect(
        await nativeStakingStrategy3.validatorsStates(
          keccak256(thirdClusterPubKeys[0])
        )
      ).to.equal(3); // EXITING state
    });
    it("Fail to request consolidation with duplicate source validators", async () => {
      const sourceValidators = [
        secondClusterPubKeys[0],
        secondClusterPubKeys[1],
        // duplicated on purpose to testing
        secondClusterPubKeys[0],
      ];

      const tx = consolidationController
        .connect(adminSigner)
        .requestConsolidation(
          nativeStakingStrategy2.address,
          sourceValidators,
          activeTargetPubKey,
          { value: 3 }
        );

      await expect(tx).to.revertedWith("Source validator not staked");
    });
    it("Fail to request consolidate from a validator that is EXITING state", async () => {
      const exitedValidatorPubKey = secondClusterPubKeys[0];
      // Exit a validator from the second cluster
      await consolidationController
        .connect(registratorSigner)
        .exitSsvValidator(
          nativeStakingStrategy2.address,
          exitedValidatorPubKey,
          secondClusterOperatorIds
        );

      // Source validator pre-conditions
      expect(
        await nativeStakingStrategy2.validatorsStates(
          keccak256(exitedValidatorPubKey)
        )
      ).to.equal(3); // EXITING state

      const tx = consolidationController
        .connect(adminSigner)
        .requestConsolidation(
          nativeStakingStrategy2.address,
          [exitedValidatorPubKey],
          activeTargetPubKey,
          { value: 1 }
        );

      await expect(tx).to.be.revertedWith("Source validator not staked");
    });
    it("Fail to request consolidate from a validator that is EXITED_COMPLETE state", async () => {
      const previouslyExitedValidatorPubKey =
        "0x8db6d9578e01ef6f1e6c655ff094a91d4ae02734d66accbdca8432eaa0b815cee503325f98b8406f2ab372a30d0f9edb";

      // Source validator pre-conditions
      expect(
        await nativeStakingStrategy2.validatorsStates(
          keccak256(previouslyExitedValidatorPubKey)
        )
      ).to.equal(4); // EXITED_COMPLETE state

      const tx = consolidationController
        .connect(adminSigner)
        .requestConsolidation(
          nativeStakingStrategy2.address,
          [previouslyExitedValidatorPubKey],
          activeTargetPubKey,
          { value: 1 }
        );

      await expect(tx).to.be.revertedWith("Source validator not staked");
    });
    it("Fail to request consolidation from an unkown source validator", async () => {
      const unknownValidatorPubKey =
        "0x808f0e79b73f968e064ecba2702a65bed93cf46149a69f0e4de921b44eab3fd456a1ca0f082887069e5831e139eb2690";

      // Source validator pre-conditions
      expect(
        await nativeStakingStrategy2.validatorsStates(
          keccak256(unknownValidatorPubKey)
        )
      ).to.equal(0); // UNKNOWN state

      const tx = consolidationController
        .connect(adminSigner)
        .requestConsolidation(
          nativeStakingStrategy2.address,
          [unknownValidatorPubKey],
          activeTargetPubKey,
          { value: 1 }
        );

      await expect(tx).to.be.revertedWith("Source validator not staked");
    });
    it("Fail to request consolidation to an UNKNOWN target validator", async () => {
      const unknownValidatorPubKey =
        "0x808f0e79b73f968e064ecba2702a65bed93cf46149a69f0e4de921b44eab3fd456a1ca0f082887069e5831e139eb2690";

      // Target validator pre-conditions
      const targetPubKeyHash = hashPubKey(unknownValidatorPubKey);
      const validatorData = await compoundingStakingStrategy.validator(
        targetPubKeyHash
      );
      expect(validatorData.state).to.equal(0); // Unknown status

      const tx = consolidationController
        .connect(adminSigner)
        .requestConsolidation(
          nativeStakingStrategy2.address,
          [secondClusterPubKeys[0]],
          unknownValidatorPubKey,
          { value: 1 }
        );

      await expect(tx).to.be.revertedWith("Target validator not active");
    });
    it("Fail to request consolidation to invalid source public key", async () => {
      // Key only 32 bytes long instead of 48 bytes
      const invlaidValidatorPubKey =
        "0x0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF";

      const tx = consolidationController
        .connect(adminSigner)
        .requestConsolidation(
          nativeStakingStrategy2.address,
          [invlaidValidatorPubKey],
          activeTargetPubKey,
          { value: 1 }
        );

      await expect(tx).to.be.revertedWith("Invalid source public key");
    });
    it("Fail to request consolidation to invalid target public key", async () => {
      // Key only 32 bytes long instead of 48 bytes
      const invlaidValidatorPubKey =
        "0x0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF";

      const tx = consolidationController
        .connect(adminSigner)
        .requestConsolidation(
          nativeStakingStrategy2.address,
          [secondClusterPubKeys[0]],
          invlaidValidatorPubKey,
          { value: 1 }
        );

      await expect(tx).to.be.revertedWith("Invalid public key");
    });
    it("Fail to request consolidation to a STAKED target validator", async () => {
      const stakedCompoundingValidatorPubKey =
        "0xa4258aa50aba9d7441f734213ae76fad9809572a593765c25c25d7afd42b83baba06397bd9e264a9fa24c3327a308682";

      // Target validator pre-conditions
      const targetPubKeyHash = hashPubKey(stakedCompoundingValidatorPubKey);
      const validatorData = await compoundingStakingStrategy.validator(
        targetPubKeyHash
      );
      expect(validatorData.state).to.equal(2); // Staked status

      const tx = consolidationController
        .connect(adminSigner)
        .requestConsolidation(
          nativeStakingStrategy2.address,
          [secondClusterPubKeys[0]],
          stakedCompoundingValidatorPubKey,
          { value: 1 }
        );

      await expect(tx).to.be.revertedWith("Target validator not active");
    });
    it("Fail to request consolidation to a target validator with a pending deposit", async () => {
      const activeWithDepositCompoundingValidatorPubKey =
        "0x87b76ce8ea170a8a6db6842848eca2f3117367ada43120401a7f3095498a910a1455352bd12d15f5a07693f61e5b8c37";

      // Target validator pre-conditions
      const targetPubKeyHash = hashPubKey(
        activeWithDepositCompoundingValidatorPubKey
      );
      const validatorData = await compoundingStakingStrategy.validator(
        targetPubKeyHash
      );
      expect(validatorData.state).to.equal(4); // Active status

      const tx = consolidationController
        .connect(adminSigner)
        .requestConsolidation(
          nativeStakingStrategy2.address,
          [secondClusterPubKeys[0]],
          activeWithDepositCompoundingValidatorPubKey,
          { value: 1 }
        );

      await expect(tx).to.be.revertedWith("Target has pending deposit");
    });
    it("Fail to request consolidation on contract controller if not admin multisig", async () => {
      const { josh, strategist, timelock } = fixture;
      const sourceValidators = [secondClusterPubKeys[0]];

      const users = [registratorSigner, josh, strategist, timelock];

      for (const user of users) {
        const tx = consolidationController
          .connect(user)
          .requestConsolidation(
            nativeStakingStrategy2.address,
            sourceValidators,
            activeTargetPubKey,
            { value: 1 }
          );

        await expect(tx).to.be.revertedWith("Ownable: caller is not the owner");
      }
    });
    it("Fail to request consolidation on native staking strategy if not Consolidation Controller", async () => {
      const { josh, strategist, timelock } = fixture;
      const sourceValidators = [secondClusterPubKeys[0]];

      const users = [
        adminSigner,
        registratorSigner,
        josh,
        strategist,
        timelock,
      ];

      for (const user of users) {
        const tx = nativeStakingStrategy2
          .connect(user)
          .requestConsolidation(sourceValidators, activeTargetPubKey, {
            value: 1,
          });

        await expect(tx).to.be.revertedWith("Caller is not the Registrator");
      }
    });
    it("Fail to call fail consolidation when there's no active consolidation", async () => {
      const tx = consolidationController
        .connect(adminSigner)
        .failConsolidation([secondClusterPubKeys[0]]);

      await expect(tx).to.be.revertedWith("No consolidation in progress");
    });
    it("Fail to directly call verifyBalance on the Compounding Staking Strategy", async () => {
      await advanceTime(12 * 40);
      await compoundingStakingStrategy.snapBalances();

      const tx = compoundingStakingStrategy
        .connect(registratorSigner)
        .verifyBalances(balanceProofs, pendingDepositProofs);

      await expect(tx).to.be.revertedWith("Not Registrator");
    });
    it("Should call doAccounting via the Consolidation Controller", async () => {
      await consolidationController
        .connect(registratorSigner)
        .doAccounting(nativeStakingStrategy2.address);

      await consolidationController
        .connect(registratorSigner)
        .doAccounting(nativeStakingStrategy3.address);
    });
    it("Fail to directly call doAccounting via the old Native Staking Strategies", async () => {
      let tx = nativeStakingStrategy2.connect(registratorSigner).doAccounting();
      await expect(tx).to.be.revertedWith("Caller is not the Registrator");

      tx = nativeStakingStrategy3.connect(registratorSigner).doAccounting();
      await expect(tx).to.be.revertedWith("Caller is not the Registrator");
    });
    it("Should exit source validators via the consolidation controller", async () => {
      await consolidationController
        .connect(registratorSigner)
        .exitSsvValidator(
          nativeStakingStrategy2.address,
          secondClusterPubKeys[0],
          secondClusterOperatorIds
        );

      await consolidationController
        .connect(registratorSigner)
        .exitSsvValidator(
          nativeStakingStrategy3.address,
          thirdClusterPubKeys[0],
          thirdClusterOperatorIds
        );
    });
    it("Fail to exit source validators directly to the native staking strategies", async () => {
      let tx = nativeStakingStrategy2
        .connect(registratorSigner)
        .exitSsvValidator(secondClusterPubKeys[0], secondClusterOperatorIds);
      await expect(tx).to.be.revertedWith("Caller is not the Registrator");

      tx = nativeStakingStrategy3
        .connect(registratorSigner)
        .exitSsvValidator(thirdClusterPubKeys[0], thirdClusterOperatorIds);
      await expect(tx).to.be.revertedWith("Caller is not the Registrator");
    });
    it("Fail to remove source validators directly to the native staking strategies", async () => {
      const emptyCluster = [
        0, // validatorCount
        0, // networkFeeIndex
        0, // index
        true, // active
        0, // balance
      ];

      let tx = nativeStakingStrategy2
        .connect(registratorSigner)
        .removeSsvValidator(
          secondClusterPubKeys[0],
          secondClusterOperatorIds,
          emptyCluster
        );
      await expect(tx).to.be.revertedWith("Caller is not the Registrator");

      tx = nativeStakingStrategy3
        .connect(registratorSigner)
        .removeSsvValidator(
          thirdClusterPubKeys[0],
          thirdClusterOperatorIds,
          emptyCluster
        );
      await expect(tx).to.be.revertedWith("Caller is not the Registrator");
    });
    it("Should partial withdraw from compounding validator via the consolidation controller", async () => {
      const withdrawAmount = ethers.utils.parseEther("2", 9);
      const targetPubKeyHash = hashPubKey(activeTargetPubKey);

      const tx = await consolidationController
        .connect(registratorSigner)
        .validatorWithdrawal(activeTargetPubKey, withdrawAmount, { value: 1 });

      await expect(tx)
        .to.emit(compoundingStakingStrategy, "ValidatorWithdraw")
        .withArgs(targetPubKeyHash, withdrawAmount.mul(parseUnits("1", 9)));
    });
    it("Fail validator exit from compounding validator via the consolidation controller", async () => {
      const tx = consolidationController
        .connect(registratorSigner)
        .validatorWithdrawal(activeTargetPubKey, 0, { value: 1 });

      await expect(tx).to.be.revertedWith("No exit during migration");
    });
    it("Should stake to compounding validator via the consolidation controller", async () => {
      const depositEth = "3";
      const depositGwei = parseUnits(depositEth, 9);
      const depositWei = parseUnits(depositEth, 18);
      const targetPubKeyHash = hashPubKey(activeTargetPubKey);

      const emptySignature =
        "0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";

      const depositDataRoot = await calcDepositRoot(
        compoundingStakingStrategy.address,
        "0x02",
        activeTargetPubKey,
        emptySignature,
        depositEth
      );

      const tx = await consolidationController
        .connect(registratorSigner)
        .stakeEth(
          {
            pubkey: activeTargetPubKey,
            signature: emptySignature,
            depositDataRoot: depositDataRoot,
          },
          depositGwei
        );

      await expect(tx)
        .to.emit(compoundingStakingStrategy, "ETHStaked")
        .withNamedArgs({
          pubKeyHash: targetPubKeyHash,
          // pendingDepositRoot
          pubKey: activeTargetPubKey,
          amountWei: depositWei,
        });
    });
  });
  describe("When consolidation in progress", () => {
    const sourceValidators = [
      secondClusterPubKeys[0],
      secondClusterPubKeys[1],
      secondClusterPubKeys[2],
    ];
    beforeEach(async () => {
      await activateTargetValidators(fixture);

      // Get the current block timestamp
      await advanceTime(12);
      const { timestamp: currentTimestamp } = await ethers.provider.getBlock(
        "latest"
      );
      const nextBlockTimestamp = currentTimestamp;
      await fixture.beaconRoots["setBeaconRoot(uint256,bytes32)"](
        // I can't control the timestamp with Hardhat
        nextBlockTimestamp + 2,
        // reusing the last balances proof assuming the balances have not changed.
        "0x67d077e55a1f4af124a8df1e1ac720d1e1e557a5305d774c5ebf98be3479cf8d"
      );

      await consolidationController
        .connect(adminSigner)
        .requestConsolidation(
          nativeStakingStrategy2.address,
          sourceValidators,
          activeTargetPubKey,
          { value: sourceValidators.length }
        );
    });
    it("Fail to request consolidation when there's an active consolidation", async () => {
      const tx = consolidationController
        .connect(adminSigner)
        .requestConsolidation(
          nativeStakingStrategy2.address,
          [secondClusterPubKeys[3]],
          activeTargetPubKey,
          { value: 1 }
        );

      await expect(tx).to.be.revertedWith("Consolidation in progress");
    });
    it("Should be able to verify balance when the consolidation was requested", async () => {
      const tx = await consolidationController
        .connect(registratorSigner)
        .verifyBalances(balanceProofs, pendingDepositProofs);

      await expect(tx).to.emit(compoundingStakingStrategy, "BalancesVerified");
    });
    // Balance proofs after the deposit to validator 13498458 has been verified.
    it("Should call snapBalance on the Compounding Staking Strategy", async () => {
      const { josh } = fixture;
      await advanceTime(12 * 40);

      const tx = await compoundingStakingStrategy.connect(josh).snapBalances();

      await expect(tx).to.emit(compoundingStakingStrategy, "BalancesSnapped");
    });
    it("Fail to verifyBalance of a snapshot after the consolidation was started", async () => {
      await advanceTime(12 * 40);
      await compoundingStakingStrategy.snapBalances();

      const tx = consolidationController
        .connect(registratorSigner)
        .verifyBalances(balanceProofs, pendingDepositProofs);

      await expect(tx).to.be.revertedWith("Consolidation in progress");
    });
    // When a consolidation has been requested
    it("Should call fail consolidation of a single validator", async () => {
      const consolidationCountBefore =
        await consolidationController.consolidationCount();
      expect(consolidationCountBefore).to.equal(3);

      const tx = await consolidationController
        .connect(adminSigner)
        .failConsolidation([sourceValidators[0]]);

      await expect(tx)
        .to.emit(nativeStakingStrategy2, "ConsolidationFailed")
        .withArgs([sourceValidators[0]], 1);
      await expect(await consolidationController.consolidationCount()).to.equal(
        consolidationCountBefore.sub(1)
      );
      expect(await consolidationController.sourceStrategy()).to.equal(
        nativeStakingStrategy2.address
      );

      // Source validator post-conditions
      expect(
        await nativeStakingStrategy2.validatorsStates(
          keccak256(sourceValidators[0])
        )
      ).to.equal(2); // STAKED state
    });
    it("Should call fail consolidation for multiple validators", async () => {
      const consolidationCountBefore =
        await consolidationController.consolidationCount();
      expect(consolidationCountBefore).to.equal(3);

      const failedValidators = [sourceValidators[0], sourceValidators[1]];

      const tx = await consolidationController
        .connect(adminSigner)
        .failConsolidation(failedValidators);

      await expect(tx)
        .to.emit(nativeStakingStrategy2, "ConsolidationFailed")
        .withArgs(failedValidators, failedValidators.length);
      await expect(await consolidationController.consolidationCount()).to.equal(
        consolidationCountBefore.sub(failedValidators.length)
      );
      expect(await consolidationController.sourceStrategy()).to.equal(
        nativeStakingStrategy2.address
      );
      expect(await consolidationController.targetPubKeyHash()).to.not.equal(
        ethers.constants.HashZero
      );

      // Source validator post-conditions
      expect(
        await nativeStakingStrategy2.validatorsStates(
          keccak256(sourceValidators[1])
        )
      ).to.equal(2); // STAKED state
    });
    it("Should call fail consolidation for all validators and reset state", async () => {
      const consolidationCountBefore =
        await consolidationController.consolidationCount();
      expect(consolidationCountBefore).to.equal(3);

      const tx = await consolidationController
        .connect(adminSigner)
        .failConsolidation(sourceValidators);

      await expect(tx)
        .to.emit(nativeStakingStrategy2, "ConsolidationFailed")
        .withArgs(sourceValidators, sourceValidators.length);
      expect(await consolidationController.consolidationCount()).to.equal(0);
      expect(await consolidationController.sourceStrategy()).to.equal(
        ethers.constants.AddressZero
      );
      expect(await consolidationController.targetPubKeyHash()).to.equal(
        ethers.constants.HashZero
      );
    });
    it("Fail to call fail consolidation if not admin multisig", async () => {
      const { josh, strategist, timelock } = fixture;
      const sourceValidators = [secondClusterPubKeys[0]];

      const users = [registratorSigner, josh, strategist, timelock];

      for (const user of users) {
        const tx = consolidationController
          .connect(user)
          .failConsolidation([sourceValidators[0]]);

        await expect(tx).to.be.revertedWith("Ownable: caller is not the owner");
      }
    });
    it("Fail to call fail consolidation to invalid source public key", async () => {
      // Key only 32 bytes long instead of 48 bytes
      const invlaidValidatorPubKey =
        "0x0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF";

      const tx = consolidationController
        .connect(adminSigner)
        .failConsolidation([invlaidValidatorPubKey]);

      await expect(tx).to.be.revertedWith("Invalid source public key");
    });
    it("Fail to stake to target of active consolidation", async () => {
      const depositEth = "3";
      const depositGwei = parseUnits(depositEth, 9);

      const emptySignature =
        "0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";

      const depositDataRoot = await calcDepositRoot(
        compoundingStakingStrategy.address,
        "0x02",
        activeTargetPubKey,
        emptySignature,
        depositEth
      );

      const tx = consolidationController.connect(registratorSigner).stakeEth(
        {
          pubkey: activeTargetPubKey,
          signature: emptySignature,
          depositDataRoot: depositDataRoot,
        },
        depositGwei
      );

      await expect(tx).to.be.revertedWith("Stake to consolidation target");
    });
    it("Fail confirm consolidation if processed too soon", async () => {
      const tx = consolidationController
        .connect(adminSigner)
        .confirmConsolidation(balanceProofs, pendingDepositProofs);

      await expect(tx).to.be.revertedWith("Source not withdrawable");
    });
  });
  describe("When consolidation in progress and balances snapped", () => {
    const sourceValidators = [
      secondClusterPubKeys[0],
      secondClusterPubKeys[1],
      secondClusterPubKeys[2],
    ];

    // Balance proofs after the deposit to validator 13498458 has been verified.
    // Run the following Hardhat task to get the proofs:
    // pnpm hardhat verifyBalances --network mainnet --dryrun true --active-ids 2178131,2183214
    const beaconBlockRoot =
      "0xa9288103774374c840f20a0419493eb7d212c37d2dd9f5cb939edc6ba71dbbd0";
    const balanceProofs = {
      balancesContainerRoot:
        "0x04db65db7a73665b33ca7ccaee2b69ec6f9f539f9140a271dcae448ea32ea703",
      balancesContainerProof:
        "0x4333928069982964e94e1bbe2c61c5faa996a4e61a3d64eb818d33d176d03ae18ce186f0e1c87ddb05aff7e2efdba134a152be5c12069e276ff6a045978151973d928aa6c51efe9d2b6c4aadca1a365587651cb2b2f8c5bd51bf521b0c749a2d7fcb39e7def4794e4bc6518a66a200295ca40e684be30efefabae3af40e856ab7ca7b06c22937561c4317f3305e283b6d6fabd4a230d5facab9c97367cca50be97cd0f019fb861a99a9e367ff02be23457b3181644b586d5d9ee19b8858e13bfd9c23ad502758c52d175f6d58baaf83b853558e11930df26cdf5305702b90fa191e7ef00c1b8963aaa0798ff7b23f54c142f4778757bfd40e47048935ec2db45c3b54249619b043128fe7460f5608f44f1c76135abb223b5e4aafee8e6d5b0b7",
      validatorBalanceLeaves: [
        "0x993fa07307000000cac46196260000009a2aa0730700000000ca9a3b00000000",
        "0xd7c523790700000000ca9a3b00000000089a9d73070000008e879d7307000000",
        "0xa53a997307000000f530997307000000395b997307000000006532eb1d000000",
        "0x661f987307000000762798730700000000a52691070000005b2a987307000000",
      ],
      validatorBalanceProofs: [
        "0x6e79a073070000003d61a073070000003394a07307000000eb9ca07307000000f9f974a80bff0a6786767069e3c22b61cd92e250ab2fa37cd70d1c558d071e0b94d83d4ed130447a93bf8946266e456611af0540067ae6744ab05728a0f6c075c320ae0c7f08ae5624e0338449009d5f5baf0e5b9643090bc0e35441821b80986984a571c410b3d370ac1d2e26b121488a1ee9999516e29537d113d6292ea540322d723e273e8de2e43730b002c21c5814e4a4d4fcaf97f9876be2d79c02a6c7b26e288dcb1da222c4451186821bc5c46828135ae11a602f17a915e98e793891dbc019da728f7cd5a9038edf2b1e5503980690d3ffb9e421c1ec007944b143680eea4daae9f346fd8457e5c1073eb9fb572e86403d4f7d5bf28c1a4de97aae2263eef95b1d0abb68b2a1cac3495da39aab302eee3a2547da81f19600bd306a92e72e061d8ff0414611c322b24f03061932985771becae851d33eaf34294a9eebd41a6764734a3aa0d91f41c6c7793a2ef3383b44d382457e08da01296210e5bfcffb3e58c7726b57e42daa66a74ab904e44afc6841ec0ae7d77ff4d6c0752ab267e6fc70b8d4871328318eed6b289e64a109ef757fd2d81876e76ee6c76af11d7ea538bd48111808f73c4c4a6bc7d5c9dd928ba9e7b4a3b535ea72d61b53b431d49a7502ffcfb0340b1d7885688500ca308161a7f96b62df9d083b71fcc8f2bb8fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a42f2d168e28658e808f575a85f3a74336c67e0c80b4b92383546da77b118829ddcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a467657cdd2986268250628d0c10e385c58c6191e6fbe05191bcc04f133f2cea72c1c4848930bd7ba8cac54661072113fb278869e07bb8587f91392933374d017bcbe18869ff2c22b28cc10510d9853292803328be4fb0e80495e8bb8d271f5b889636b5fe28e79f1b850f8658246ce9b6a1e7b49fc06db7143e8fe0b4f2b0c5523a5c985e929f70af28d0bdd1a90a808f977f597c7c778c489e98d3bd8910d31ac0f7c6f67e02e6e4e1bdefb994c6098953f34636ba2b6ca20a4721d2b26a886722ff1c9a7e5ff1cf48b4ad1582d3f4e4a1004f3b20d8c5a2b71387a4254ad933ebc52f075ae229646b6f6aed19a5e372cf295081401eb893ff599b3f9acc0c0d3e7d328921deb59612076801e8cd61592107b5c67c79b846595cc6320c395b46362cbfb909fdb236ad2411b4e4883810a074b840464689986c3f8a8091827e17c32755d8fb3687ba3ba49f342c77f5a1f89bec83d811446e1a467139213d640b6a748d8e210000000000000000000000000000000000000000000000000000000000",
        "0xd9629d730700000026649d7307000000643f9d730700000071889d7307000000c78d64f9647fd45467c3045f6c14124d4e01f91eea94893915f02ebd06aeaa7a71458e41c1c95553a23badd65b3633709985c47222992bcd580ee3127e6c87c6531a4d2d8b27a1f18b831138c814d2c9552a5847dcf1ac1c07f7f403e3125c888c3707d36dc5cce04b06f8c0878c73367ee83bdff86192de5ea3d8f0c8629e52a6e457151cf12c3df988c96ecd31837ef62304447cbbecef5398018b29596e1b7f6511917fa05b91497b64b04b9071d496c2ee839a83f01c3377c59020ab19b0d08e5382cd2c2106faa75f5ce1925c38484459bd84ea2918964d63cb5dddc61ad4be71d35cd5bba9d0678929fab2c879b17f4d6d930cb746a145319f6bc2ccf84da1c71aa51549985a242b3c5e4e54e6d3f07bc5d0476c32ce84d02bc437d21e1c2ecf985a7beb65a3ed032fb078cfb30baf94505c1d8be7300bdb9719fd16d8fc8b400c7e5ff863815887a13b420d92f4b5fcc00217b8c97b19460f55e110c5cffb3e58c7726b57e42daa66a74ab904e44afc6841ec0ae7d77ff4d6c0752ab267e6fc70b8d4871328318eed6b289e64a109ef757fd2d81876e76ee6c76af11d7ea538bd48111808f73c4c4a6bc7d5c9dd928ba9e7b4a3b535ea72d61b53b431d49a7502ffcfb0340b1d7885688500ca308161a7f96b62df9d083b71fcc8f2bb8fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a42f2d168e28658e808f575a85f3a74336c67e0c80b4b92383546da77b118829ddcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a467657cdd2986268250628d0c10e385c58c6191e6fbe05191bcc04f133f2cea72c1c4848930bd7ba8cac54661072113fb278869e07bb8587f91392933374d017bcbe18869ff2c22b28cc10510d9853292803328be4fb0e80495e8bb8d271f5b889636b5fe28e79f1b850f8658246ce9b6a1e7b49fc06db7143e8fe0b4f2b0c5523a5c985e929f70af28d0bdd1a90a808f977f597c7c778c489e98d3bd8910d31ac0f7c6f67e02e6e4e1bdefb994c6098953f34636ba2b6ca20a4721d2b26a886722ff1c9a7e5ff1cf48b4ad1582d3f4e4a1004f3b20d8c5a2b71387a4254ad933ebc52f075ae229646b6f6aed19a5e372cf295081401eb893ff599b3f9acc0c0d3e7d328921deb59612076801e8cd61592107b5c67c79b846595cc6320c395b46362cbfb909fdb236ad2411b4e4883810a074b840464689986c3f8a8091827e17c32755d8fb3687ba3ba49f342c77f5a1f89bec83d811446e1a467139213d640b6a748d8e210000000000000000000000000000000000000000000000000000000000",
        "0xb77e99730700000031919973070000004d769973070000002888997307000000d02bb05b7a360b47b47089a4c46c1dc751bfc7455fba9f3b9b7c0dbda00a0ade3a16305ac8fdeff38b4c4a5b826ad7f84d3cd87b2f98c32a5b8d885680b7f1b5e7b934be1829de360901f0955f2ec575503ce73b24fe2a508065d6af6e5787d0b1f3ba3557f696ac5b06509cdc732d3a1f08174e45c515f030f89b99b74a9ce5c4a9eb72cbf99c62d6adc039752715f5be2f1424631042c144978be4e223a7c517b2177a24aec334b980cf174382e52ac48506ed9f8c3827a62b93eeeadc03eeb2e4b6098ab1b6cbfecc1539911e63f5c95eaa066d295d08e8b5365315257ae5cabfed97493d55e991675652e7aae50c00404f46e5abc649a3bfc803e113e1e4b1f9582a7881c3b926f559e49cacb1cd43f44760b6789748ffd17c01ca98ed5abf9d3e8450926ba2183a48b2419a8d8bc7702078ddd5f3863ea639e28348e16ca0304405e3dbaf1298b1881df2ddc8deface5aca4bf6e60db869e6b9d7f13bf3f78934fef79502e08e70ae283743d2eaa21d5dd25ca807db35e029001e303bfbe2324dff6da74cad13ea5a5ef64db35af2c26b92e62c90f52f7ddeeb52981c6fbddafe6d13f3b1e00c3f111d31b9ff99e0d535f686c5d6ffeac2674f9ee45043d49a7502ffcfb0340b1d7885688500ca308161a7f96b62df9d083b71fcc8f2bb8fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a42f2d168e28658e808f575a85f3a74336c67e0c80b4b92383546da77b118829ddcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a467657cdd2986268250628d0c10e385c58c6191e6fbe05191bcc04f133f2cea72c1c4848930bd7ba8cac54661072113fb278869e07bb8587f91392933374d017bcbe18869ff2c22b28cc10510d9853292803328be4fb0e80495e8bb8d271f5b889636b5fe28e79f1b850f8658246ce9b6a1e7b49fc06db7143e8fe0b4f2b0c5523a5c985e929f70af28d0bdd1a90a808f977f597c7c778c489e98d3bd8910d31ac0f7c6f67e02e6e4e1bdefb994c6098953f34636ba2b6ca20a4721d2b26a886722ff1c9a7e5ff1cf48b4ad1582d3f4e4a1004f3b20d8c5a2b71387a4254ad933ebc52f075ae229646b6f6aed19a5e372cf295081401eb893ff599b3f9acc0c0d3e7d328921deb59612076801e8cd61592107b5c67c79b846595cc6320c395b46362cbfb909fdb236ad2411b4e4883810a074b840464689986c3f8a8091827e17c32755d8fb3687ba3ba49f342c77f5a1f89bec83d811446e1a467139213d640b6a748d8e210000000000000000000000000000000000000000000000000000000000",
        "0xde3a9873070000007e9c38c034000000b82898730700000066ca97730700000092f26188d26035c476de7bc06f330e15b2b0ac906cf4f417a54b57c4546cfa77cbe9660eebbedffed2811e7abba791cffb013dea1499353940acf83acdcdbdc1bb66f78480ea569b96f7f87db41e184a31349f10980f40bb8911dee3ba264451b8e70214ff1abbf8c8d925934d5643778b48f5fe18fd1203a2fac5cdb24c547ecd2b53f340ba403acf614723908627d8f7b27905cbe379c553c564fbc7f421ff88e6d0c0a419a1eda6cbe6149e5c5450bcc733dc52b3491f52c9705bbd7508fbafdfbd5caf880a7c556cf52e240d9230d5ab9f14161a8ac3ca8d7a2594dbea5db9a8b250f8edd510c4cb52956ce77c158609cb694ceafa4593ea20b41a8c097dfc8c17126489572c19497e1edd06ca9472d39a6cd018cf2621ddc2befc6385f14ba9aae0bc35029a77d73049555db9826f4b56b4bde27a758dc7180a9a8fd290acbf1b791a21e9c674ba9283fc110cf75f7163cec145020a03a38efc99628501463cbd547b6bdd2a80ba2d3b7620728d0448304725d2f8307f4fbbb8c0820d33e2324dff6da74cad13ea5a5ef64db35af2c26b92e62c90f52f7ddeeb52981c6fbddafe6d13f3b1e00c3f111d31b9ff99e0d535f686c5d6ffeac2674f9ee45043d49a7502ffcfb0340b1d7885688500ca308161a7f96b62df9d083b71fcc8f2bb8fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a42f2d168e28658e808f575a85f3a74336c67e0c80b4b92383546da77b118829ddcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a467657cdd2986268250628d0c10e385c58c6191e6fbe05191bcc04f133f2cea72c1c4848930bd7ba8cac54661072113fb278869e07bb8587f91392933374d017bcbe18869ff2c22b28cc10510d9853292803328be4fb0e80495e8bb8d271f5b889636b5fe28e79f1b850f8658246ce9b6a1e7b49fc06db7143e8fe0b4f2b0c5523a5c985e929f70af28d0bdd1a90a808f977f597c7c778c489e98d3bd8910d31ac0f7c6f67e02e6e4e1bdefb994c6098953f34636ba2b6ca20a4721d2b26a886722ff1c9a7e5ff1cf48b4ad1582d3f4e4a1004f3b20d8c5a2b71387a4254ad933ebc52f075ae229646b6f6aed19a5e372cf295081401eb893ff599b3f9acc0c0d3e7d328921deb59612076801e8cd61592107b5c67c79b846595cc6320c395b46362cbfb909fdb236ad2411b4e4883810a074b840464689986c3f8a8091827e17c32755d8fb3687ba3ba49f342c77f5a1f89bec83d811446e1a467139213d640b6a748d8e210000000000000000000000000000000000000000000000000000000000",
      ],
    };
    const pendingDepositProofs = {
      pendingDepositContainerRoot:
        "0x1569283d34597682dc23df5d7d810741423a982dba2894e7c91a0500523fe02f",
      pendingDepositContainerProof:
        "0xa60a4d51806f867a41eef3270b5ffb01887ea65cf77271331306ba85f050048b118a5c45359c979999bcac5171498a35bb6439765ea29d9f10562c192c13ae796428ec097c86205afcc2e69f57dc61514a5307a7e3b424ab5333ed4639253256c78009fdf07fc56a11f122370658a353aaa542ed63e44c4bc15ff4cd105ab33c536d98837f2dd165a55d5eeae91485954472d56f246df256bf3cae19352a123ce7dc01930d07951b83a7e539d5cf357726999569554507d4ab3713d4a9480af0d9c23ad502758c52d175f6d58baaf83b853558e11930df26cdf5305702b90fa191e7ef00c1b8963aaa0798ff7b23f54c142f4778757bfd40e47048935ec2db45c3b54249619b043128fe7460f5608f44f1c76135abb223b5e4aafee8e6d5b0b7",
      pendingDepositIndexes: [
        "14592",
        "18641",
        "18654",
        // "18655",
        "42817",
        "18656",
        "35285",
        "42812",
        "42814",
        "42815",
        "42816",
      ],
      pendingDepositProofs: [
        "0xc34fff8478db7d3bcdfa064f5620abc7f87efc0ece599a0ebc234493e4a6c0f7a3fca46f27005d5e08cbe601ee7529043fb88f46b046a2b37a6faec7d92932f78daff34b76dbe62def8dfbf54d17adbdc1243db4167f129513fb3b9e0b1d7ef9e1cbac8158d3087f520cd5459a3b0db6113269d020e7f40772c33521a557a63122c16bb638cd7b8b2cc3b5c1c26f0be4ea144717878c8d774507d74b851816e5315fa1dfe6b9bb9c27209771789e90f7e6fbc490ed964b5552e8c22e4d907b256580598512a4db0eb0e4c6cef62742d52c47f1e44646e5a8e79ea3fdfa51c3ae852c72a6a97944f77d37ee51ff79416849c72a3a2c61f86ec599e94a85864e5283c59a9cbe6cb402b9d6d48d20a38ac28e47f3243652b5d1658b9cd25ccf9da03553442b0fb9ea1c77f2839f3e8eb359c2e87f5c09db49a10ea2015e03ae16f2792fabb75492d055819a7d8e4514e66c5ce14208bee1279a9a02e2cb8b0ffe454ae4017ed96ce26ffc9ae3cc2f1fce9d79597798532f6df2893363f3f7633eca880fde3f6a4137c917afc4104d5d8f33bcf271da1090d81b09e09077c8be5d4e3e7f23d01ce85ade307fa12acfa6112ba7e60a9159a23c15d00d7c6b9427f6630fa1cb5a50c072572e12b3009f555ab1ed4a90cf6aa6b3e3ffa0156260e687b5312e49477bb59d3016819e9adcb853b6371bc146c84b482fab3414fd5f4612688fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
        "0xd98c9a9c84ff39129af4c465a360954ef94e76839a04354e57a1e7ef70ffe3eaa6dc8f3bbf7727f23d669cb37b7a25915b6e3e64f62aa817620e237a8b1d6c05d2575e68e5d2e8142e6311090237b07f9ca7d2e6a79f34752a98298a167774ba7b6d6b065c3b016f4ca962b544a59988981736024e1e14ece3c8de665ebddee5d4f4c56882e543b8352f8ecc371b39467f3f7a660e8e41d9e918e6ecd20c1eacf1b45620abc0f8f2bee0917fd48101ae5b629b50a23afa76b409de0a54f6f51a054db1ada756bc37669859c7a309be6c8bbc1d05109e8e51bc8d635e3f57a38348f6ae4433379f2cd415a9ddd52bff62e88dba00281c8e51de4b57d0636aa5b277da6d4d23dd92f1e71e3b671ca3c45b47649a049376c461d9f0d19679d33dd4839f5f2152af17116cfadc4382a7f7626d4840394227a3cc44108d5584dc20b0bccaafc30d905fd95026d1d420e485bcb4b9d5436a15e30a07c13edd66abb77dd931fb819fdc6461cbbaa93e8982663d4b903a26cd3ca1891758e91a8c5702bec749228cb8174b260f8ef7e4c0a56409a5df0ead649a5a664c4ab5479bbd4237efd3162264f690aa3916c2c5262ac3e65f933ca2ac585840abe071514f3944c37011fe9710afb2674b9b238ee6e7a1e264244ea047c87ee47f3b51e36850633b312e49477bb59d3016819e9adcb853b6371bc146c84b482fab3414fd5f4612688fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
        "0x78064553d435f3967fac15770e814581d47ff07d01f38e35450cb0c45fc17caec27075fdee7f613c814ed44eef6c6059ed7f56290c62176aa2886fdd3c9c52cd715d7f7cd06b8aea6a345558abca48f6c5d9cc3ffc5155d6330266fdbe42b26ed86185ec784e73ff76d302b6646deffb2b4cdf0a7efb5c2f82d860b20447d430d4f4c56882e543b8352f8ecc371b39467f3f7a660e8e41d9e918e6ecd20c1eacf1b45620abc0f8f2bee0917fd48101ae5b629b50a23afa76b409de0a54f6f51a054db1ada756bc37669859c7a309be6c8bbc1d05109e8e51bc8d635e3f57a38348f6ae4433379f2cd415a9ddd52bff62e88dba00281c8e51de4b57d0636aa5b277da6d4d23dd92f1e71e3b671ca3c45b47649a049376c461d9f0d19679d33dd4839f5f2152af17116cfadc4382a7f7626d4840394227a3cc44108d5584dc20b0bccaafc30d905fd95026d1d420e485bcb4b9d5436a15e30a07c13edd66abb77dd931fb819fdc6461cbbaa93e8982663d4b903a26cd3ca1891758e91a8c5702bec749228cb8174b260f8ef7e4c0a56409a5df0ead649a5a664c4ab5479bbd4237efd3162264f690aa3916c2c5262ac3e65f933ca2ac585840abe071514f3944c37011fe9710afb2674b9b238ee6e7a1e264244ea047c87ee47f3b51e36850633b312e49477bb59d3016819e9adcb853b6371bc146c84b482fab3414fd5f4612688fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
        // "0xf3d2b82cf422ce4c080a3cf85eeb154d9dac080d401df3f8fb2cc26bddd348b7c27075fdee7f613c814ed44eef6c6059ed7f56290c62176aa2886fdd3c9c52cd715d7f7cd06b8aea6a345558abca48f6c5d9cc3ffc5155d6330266fdbe42b26ed86185ec784e73ff76d302b6646deffb2b4cdf0a7efb5c2f82d860b20447d430d4f4c56882e543b8352f8ecc371b39467f3f7a660e8e41d9e918e6ecd20c1eacf1b45620abc0f8f2bee0917fd48101ae5b629b50a23afa76b409de0a54f6f51a054db1ada756bc37669859c7a309be6c8bbc1d05109e8e51bc8d635e3f57a38348f6ae4433379f2cd415a9ddd52bff62e88dba00281c8e51de4b57d0636aa5b277da6d4d23dd92f1e71e3b671ca3c45b47649a049376c461d9f0d19679d33dd4839f5f2152af17116cfadc4382a7f7626d4840394227a3cc44108d5584dc20b0bccaafc30d905fd95026d1d420e485bcb4b9d5436a15e30a07c13edd66abb77dd931fb819fdc6461cbbaa93e8982663d4b903a26cd3ca1891758e91a8c5702bec749228cb8174b260f8ef7e4c0a56409a5df0ead649a5a664c4ab5479bbd4237efd3162264f690aa3916c2c5262ac3e65f933ca2ac585840abe071514f3944c37011fe9710afb2674b9b238ee6e7a1e264244ea047c87ee47f3b51e36850633b312e49477bb59d3016819e9adcb853b6371bc146c84b482fab3414fd5f4612688fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
        "0xb052e26ca38ea7d23a9d8e2b4e0930caec9762902558a0c69a6165d2b34225ceb952f1c1498e677bc53c02cbc5508746390ee5fe28ac78bb3269e3d508f26cb59cee7306db15b383b855e646ac37b0037cb71362f1d6d572080e23f4774cba5b83729aa771eef156624149b21cc655b1488a5d57d6bce4e10b93f5172eeb54731f5d33a55787852d3b1eecc7fb0c066d055b7b39c33b2ff209ec1ef5dd2645e3f4823e7cd8705b6e071b9a6c1e2f03a5f526aae52320ed0a47059c65f119d1a17f42fa6b8a8ab1e90adf86a48397eed6926f631596053f591befeb78b7bce41dbf72cb7943c7c59edd04b8f76160f3ce886a13706747047a83a7776a8215b104c90ce5e1fe6d0bde131ab5ecc1b711d7985281eca4e8a1af2769bd5cf6ef9c144c94a31e5bd4250f9581a65fe2fd5f7d50376a14c30d6ba56e02b806f1db61d3009f2a7742dc822473ab080134a0a7ef13a44c7d657d8eaba02ed5cc9fdd814617a608e510334d3112f80398e8650333342c623260139a0143aa59b31abb4348b7d05f875f140027ef5118a2247bbb84ce8f2f0f1123623085daf7960c329f5f339eebeac8b5a6dcaa2a8be7227579f7b9654cbff561a6aa52648171fdff2861b58d900f5e182e3c50ef74969ea16c7726c549757cc23523c369587da7293784334389ca1621fcc084f1855c0c04827935652cbdcc1b4a1fd86bac1043eb66138fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
        "0x5d4ccd48749dab4278da9cdac6c4307647c9287f533d3d356e68c4ee98fb0a46e8c5f7210f713ab37dbf19ecd3b8b9a7efb14416de0d3fa3e663e9bd0675de0e151c24b9083561527aef588aed23ce467699f1120fb8864322ec6227fafe777c5d59607058d300335b3fadbfe7a836122a6a61dd52be457a2fd343c76770f9b04bff6e9528399b0b7fdfd0933fefabb68f8b21f90c198a8a65e5b6094994500ceb9ba8d26bb5ff57bc9f8cb8437dee73e4953aa2bafe217f80646a5246616896054db1ada756bc37669859c7a309be6c8bbc1d05109e8e51bc8d635e3f57a38348f6ae4433379f2cd415a9ddd52bff62e88dba00281c8e51de4b57d0636aa5b277da6d4d23dd92f1e71e3b671ca3c45b47649a049376c461d9f0d19679d33dd4839f5f2152af17116cfadc4382a7f7626d4840394227a3cc44108d5584dc20b0bccaafc30d905fd95026d1d420e485bcb4b9d5436a15e30a07c13edd66abb77dd931fb819fdc6461cbbaa93e8982663d4b903a26cd3ca1891758e91a8c5702bec749228cb8174b260f8ef7e4c0a56409a5df0ead649a5a664c4ab5479bbd4237efd3162264f690aa3916c2c5262ac3e65f933ca2ac585840abe071514f3944c37011fe9710afb2674b9b238ee6e7a1e264244ea047c87ee47f3b51e36850633b312e49477bb59d3016819e9adcb853b6371bc146c84b482fab3414fd5f4612688fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
        "0xcf0e9204a7384274c77ca593765bdb8977559a06ccef58b97cce1ea31de7ec5a5b61a2cd6171697d878b6c178c6a8a180fc24c1b2ee433d66bee4129e2fb2a1fcd03fb13dfa90c6ba0323a71b8f7458faa3bf5f57747b1757966625f9b5cecc38b4b5efb7d0401573d4b89eea1f5738f376ef80150c558f3cc05629be8ee935a9c6e1dd8e5b3386813d41822cdbb3178a53884979620df900cb63eec56eb23809173ec8acfba0f4111df1b408826859e9da75cb2899653c13cacbdd9a7398bf910de7c9c141ac086a8257fb7b8c68c725d7d477b1c45fc556c1665a6c92f5c23155ab64148050f5bcdc0bf48a1b8d13ca78e879096d3f742864d13c210aeab95dd2571ca852b08666160c93b9bbba9b4d371b97d1a17539b2959f5be7cb0619f63cfa12bdf7b64e69bfaf0600143b773d03921ac7f01ff77e6206eff4a113fe6b9be8fbf22328b8b2d76364813440c320b252e74672b69a3f158452736237c74219567d9d9d30ad143ad66caa1bd66dfb32337bf10b96c0fc9b279b0c89ff1ff891f2095fdf76e6d58f76c4d453b996653d9b09222147c62dffeffc6d4e1932e46f2945ad7014eb8473a29b9c0f94a4b2f61536afcdc6facdde1ec91c4c4c7d3b58d900f5e182e3c50ef74969ea16c7726c549757cc23523c369587da7293784334389ca1621fcc084f1855c0c04827935652cbdcc1b4a1fd86bac1043eb66138fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
        "0x308dba54c2444e4683aa4c92c423532dae274d39dc0a95a2871b90006b41a357ad345f10252274408791763ea728c60cfd0c0e4b830a4478358e903ea5fb8e9d47fcd7bf440d62e8031f4585781fdd8a3b8f29c2d82c881af4741fd598a64b9ac890a21e659109ef7b6b84ec60714d1d443075f277d180275e88fc3c17653a5d036bbd350e68ea77b980f450ef888c3d179557bb9de0ec4587213bc7977cf2959269b860abf8016a8ae51aa4d53da0d2d284bb2dfaef0dc56a4a554ee9138ade92482e73817c7525b477566ab0c97d998dd6ce7ed099fbecf167e397921dd6e8bf72cb7943c7c59edd04b8f76160f3ce886a13706747047a83a7776a8215b104c90ce5e1fe6d0bde131ab5ecc1b711d7985281eca4e8a1af2769bd5cf6ef9c144c94a31e5bd4250f9581a65fe2fd5f7d50376a14c30d6ba56e02b806f1db61d3009f2a7742dc822473ab080134a0a7ef13a44c7d657d8eaba02ed5cc9fdd814617a608e510334d3112f80398e8650333342c623260139a0143aa59b31abb4348b7d05f875f140027ef5118a2247bbb84ce8f2f0f1123623085daf7960c329f5f339eebeac8b5a6dcaa2a8be7227579f7b9654cbff561a6aa52648171fdff2861b58d900f5e182e3c50ef74969ea16c7726c549757cc23523c369587da7293784334389ca1621fcc084f1855c0c04827935652cbdcc1b4a1fd86bac1043eb66138fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
        "0x5884a4ac9f90f068ebec13e3be02253bc0f44b196572038dd09e77edf8ec0d5d9419046f0790d907a2d00e8a8550a1cf671b4d41eed19837d6c767ce094d5ec247fcd7bf440d62e8031f4585781fdd8a3b8f29c2d82c881af4741fd598a64b9ac890a21e659109ef7b6b84ec60714d1d443075f277d180275e88fc3c17653a5d036bbd350e68ea77b980f450ef888c3d179557bb9de0ec4587213bc7977cf2959269b860abf8016a8ae51aa4d53da0d2d284bb2dfaef0dc56a4a554ee9138ade92482e73817c7525b477566ab0c97d998dd6ce7ed099fbecf167e397921dd6e8bf72cb7943c7c59edd04b8f76160f3ce886a13706747047a83a7776a8215b104c90ce5e1fe6d0bde131ab5ecc1b711d7985281eca4e8a1af2769bd5cf6ef9c144c94a31e5bd4250f9581a65fe2fd5f7d50376a14c30d6ba56e02b806f1db61d3009f2a7742dc822473ab080134a0a7ef13a44c7d657d8eaba02ed5cc9fdd814617a608e510334d3112f80398e8650333342c623260139a0143aa59b31abb4348b7d05f875f140027ef5118a2247bbb84ce8f2f0f1123623085daf7960c329f5f339eebeac8b5a6dcaa2a8be7227579f7b9654cbff561a6aa52648171fdff2861b58d900f5e182e3c50ef74969ea16c7726c549757cc23523c369587da7293784334389ca1621fcc084f1855c0c04827935652cbdcc1b4a1fd86bac1043eb66138fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
        "0xac9a98d48b7b13938bbf6c50c07b7d9f41c78c2dc9515280ec3cab9209ac44ba9419046f0790d907a2d00e8a8550a1cf671b4d41eed19837d6c767ce094d5ec247fcd7bf440d62e8031f4585781fdd8a3b8f29c2d82c881af4741fd598a64b9ac890a21e659109ef7b6b84ec60714d1d443075f277d180275e88fc3c17653a5d036bbd350e68ea77b980f450ef888c3d179557bb9de0ec4587213bc7977cf2959269b860abf8016a8ae51aa4d53da0d2d284bb2dfaef0dc56a4a554ee9138ade92482e73817c7525b477566ab0c97d998dd6ce7ed099fbecf167e397921dd6e8bf72cb7943c7c59edd04b8f76160f3ce886a13706747047a83a7776a8215b104c90ce5e1fe6d0bde131ab5ecc1b711d7985281eca4e8a1af2769bd5cf6ef9c144c94a31e5bd4250f9581a65fe2fd5f7d50376a14c30d6ba56e02b806f1db61d3009f2a7742dc822473ab080134a0a7ef13a44c7d657d8eaba02ed5cc9fdd814617a608e510334d3112f80398e8650333342c623260139a0143aa59b31abb4348b7d05f875f140027ef5118a2247bbb84ce8f2f0f1123623085daf7960c329f5f339eebeac8b5a6dcaa2a8be7227579f7b9654cbff561a6aa52648171fdff2861b58d900f5e182e3c50ef74969ea16c7726c549757cc23523c369587da7293784334389ca1621fcc084f1855c0c04827935652cbdcc1b4a1fd86bac1043eb66138fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
        "0xe43aa97c7b45d686240e148893fb944692f4a5513afca99a351c1f20e26c5597b952f1c1498e677bc53c02cbc5508746390ee5fe28ac78bb3269e3d508f26cb59cee7306db15b383b855e646ac37b0037cb71362f1d6d572080e23f4774cba5b83729aa771eef156624149b21cc655b1488a5d57d6bce4e10b93f5172eeb54731f5d33a55787852d3b1eecc7fb0c066d055b7b39c33b2ff209ec1ef5dd2645e3f4823e7cd8705b6e071b9a6c1e2f03a5f526aae52320ed0a47059c65f119d1a17f42fa6b8a8ab1e90adf86a48397eed6926f631596053f591befeb78b7bce41dbf72cb7943c7c59edd04b8f76160f3ce886a13706747047a83a7776a8215b104c90ce5e1fe6d0bde131ab5ecc1b711d7985281eca4e8a1af2769bd5cf6ef9c144c94a31e5bd4250f9581a65fe2fd5f7d50376a14c30d6ba56e02b806f1db61d3009f2a7742dc822473ab080134a0a7ef13a44c7d657d8eaba02ed5cc9fdd814617a608e510334d3112f80398e8650333342c623260139a0143aa59b31abb4348b7d05f875f140027ef5118a2247bbb84ce8f2f0f1123623085daf7960c329f5f339eebeac8b5a6dcaa2a8be7227579f7b9654cbff561a6aa52648171fdff2861b58d900f5e182e3c50ef74969ea16c7726c549757cc23523c369587da7293784334389ca1621fcc084f1855c0c04827935652cbdcc1b4a1fd86bac1043eb66138fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4f893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17fcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9cfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167e71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d731206fa80a50bb6abe29085058f16212212a60eec8f049fecb92d8c8e0a84bc021352bfecbeddde993839f614c3dac0a3ee37543f9b412b16199dc158e23b544619e312724bb6d7c3153ed9de791d764a366b389af13c58bf8a8d90481a4676565af000000000000000000000000000000000000000000000000000000000000",
      ],
    };
    const minWithdrableTime = 256 * 32 * 12; // 256 epochs

    beforeEach(async () => {
      await activateTargetValidators(fixture);

      await consolidationController
        .connect(adminSigner)
        .requestConsolidation(
          nativeStakingStrategy2.address,
          sourceValidators,
          activeTargetPubKey,
          { value: sourceValidators.length }
        );

      await advanceTime(minWithdrableTime);

      // Get the current block timestamp
      await advanceTime(12 * 40);
      const { timestamp: currentTimestamp } = await ethers.provider.getBlock(
        "latest"
      );
      const nextBlockTimestamp = currentTimestamp;
      await fixture.beaconRoots["setBeaconRoot(uint256,bytes32)"](
        // I can't control the timestamp with Hardhat
        nextBlockTimestamp + 2,
        beaconBlockRoot
      );

      await compoundingStakingStrategy.connect(fixture.josh).snapBalances();
    });

    it("Should confirm consolidation", async () => {
      const { weth } = fixture;

      const compoundingStrategyBalanceBefore =
        await compoundingStakingStrategy.checkBalance(weth.address);
      const nativeStrategyBalanceBefore =
        await nativeStakingStrategy2.checkBalance(weth.address);
      const consolidationCountBefore =
        await consolidationController.consolidationCount();
      expect(consolidationCountBefore).to.equal(3);
      const activeDepositedValidatorsBefore =
        await nativeStakingStrategy2.activeDepositedValidators();

      const tx = await consolidationController
        .connect(adminSigner)
        .confirmConsolidation(balanceProofs, pendingDepositProofs);

      await expect(tx)
        .to.emit(nativeStakingStrategy2, "ConsolidationConfirmed")
        .withArgs(
          consolidationCountBefore,
          activeDepositedValidatorsBefore.sub(consolidationCountBefore)
        );
      expect(await consolidationController.consolidationCount()).to.equal(0);
      expect(await consolidationController.sourceStrategy()).to.equal(
        ethers.constants.AddressZero
      );
      expect(await consolidationController.targetPubKeyHash()).to.equal(
        ethers.constants.HashZero
      );
      expect(await nativeStakingStrategy2.activeDepositedValidators()).to.equal(
        activeDepositedValidatorsBefore.sub(consolidationCountBefore)
      );

      // then changes in the strategy balances should net off
      const compoundingStrategyBalanceAfter =
        await compoundingStakingStrategy.checkBalance(weth.address);
      const nativeStrategyBalanceAfter =
        await nativeStakingStrategy2.checkBalance(weth.address);
      expect(
        compoundingStrategyBalanceAfter
          .sub(compoundingStrategyBalanceBefore)
          .add(nativeStrategyBalanceAfter.sub(nativeStrategyBalanceBefore))
      ).to.equal(0);
    });
    it("Should not confirm consolidation twice", async () => {
      await consolidationController
        .connect(adminSigner)
        .confirmConsolidation(balanceProofs, pendingDepositProofs);

      const tx = consolidationController
        .connect(adminSigner)
        .confirmConsolidation(balanceProofs, pendingDepositProofs);

      await expect(tx).to.be.revertedWith("No consolidation in progress");
    });
    it("Fail confirm consolidation if not admin multisig", async () => {
      const { josh, strategist, timelock } = fixture;
      const users = [registratorSigner, josh, strategist, timelock];

      for (const user of users) {
        const tx = consolidationController
          .connect(user)
          .confirmConsolidation(balanceProofs, pendingDepositProofs);

        await expect(tx).to.be.revertedWith("Ownable: caller is not the owner");
      }
    });
    it("Fail confirm consolidation with invalid balance proofs", async () => {
      const invalidBalanceProofs = structuredClone(balanceProofs);
      invalidBalanceProofs.validatorBalanceLeaves[0] =
        "0x0000000000000000000000000000000000000000000000000000000000000000";

      const tx = consolidationController
        .connect(adminSigner)
        .confirmConsolidation(invalidBalanceProofs, pendingDepositProofs);

      await expect(tx).to.be.revertedWith("Invalid balance proof");
    });
    it("Fail confirm consolidation with invalid pending deposit proofs", async () => {
      const invalidPendingDepositProofs = structuredClone(pendingDepositProofs);
      invalidPendingDepositProofs.pendingDepositIndexes[0] = "1234";

      const tx = consolidationController
        .connect(adminSigner)
        .confirmConsolidation(balanceProofs, invalidPendingDepositProofs);

      await expect(tx).to.be.revertedWith("Invalid deposit proof");
    });
  });
});
